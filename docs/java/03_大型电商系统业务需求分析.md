## 03_大型电商系统业务需求分析

### 01_传统培训的弊端以及我们的真实项目驱动式培训思路

#### 传统培训行业的弊端

其实从这个课程开始，就正式进入了咱们的真正的架构师课程 

思路：实际上就是用一个完全真实的项目背景来驱动，在这个有复杂业务场景的项目中，去讲解各个技术是如何落地使用的 

我自己之前讲课，spark，elasticsearch 

还有我观察到，行业里其他做培训的机构，包括说一些现在也在做java架构师培训的一些机构，采取的还是老一套的办法 

6个月 

5个月，就是一个一个的技术，一个知识点，一个知识点的去讲解，可能每个知识点，会给你做一个案例，做一个demo。每个月的知识学习之后，给你一个什么什么项目（demo），复杂的业务需求，纯就是用很简单的业务做一点东西出来，demo 

学东西一定能学到，黑竞争对手，用实力说话  

一定能学到一些东西，但是问题是在于，真正如何跟项目中的业务场景结合，技术的解决业务问题的理解深度，实践深度，技术本身的理解，不够。很容易遗忘 

讲课的方法，脱胎于大学里，先是很枯燥的，书本，一章一章的讲解，全部是理论，小的项目实战，案例实战，练习 

1、纯技术，纯理论的学习，会让人感觉很枯燥 

2、你学习了很长时间的技术之后，如果没有像公司里做项目一样，立即将这些技术使用到你实际的业务需求里，用技术去做需求。很快会把学习到的一些技术给忘了 

引申一点点：为什么说你的技术是由多年的工作经验积累出来的。因为你实际在工作中，比如说半年，或者1年的一个大项目，做了。为了做这个项目，为了实现里面的业务需求，业务场景，解决问题，性能问题，并发问题，可用性问题，稳定性问题，线上运维，可能做了很多的事情 

在工作里面会由项目需求驱动，学习了一些技术，快速的将这些技术应用到了你的工作场景中，效果还不错，实际解决了项目里的技术问题，成就感，印象很深刻 

如果是经过项目中的业务需求洗礼的话，你对一个技术的理解深度、掌握程度、记忆深刻度，至少是你纯理论学习的10倍以上，5倍~10倍 

BAT公司里的人出来，说我是技术大牛，包括我也一样 

实际上来说，我们学习跟大家学习，技术，不管是通过什么途径去学习，这个本质差别不大 

BAT里，公司，高并发、高可用、高复杂度、线上系统运维坑多、性能问题多，挑战摆那儿，我们学习技术之后，大量的在公司项目里实践，这种情况下，积累出来的技术、架构、深度，绝对是说，会达到普通人，一些小公司的同学，自己看看视频，自己看看书，10倍以上 

真正在项目里面踩过坑，遇到了，有绝对复杂的业务场景，技术一定是在一个业务场景中，深刻理解业务的情况下，用技术去解决业务的问题，反过来对你对技术的理解和掌握，那是意义非常的大，比你单纯看本书来说，意义要大很多 

3、对技术的解决业务问题的理解深度，实践深度，技术本身的理解，不够 

4、出去，感觉到虚，实际上来说，你没有真正用技术去做过项目，10几个项目，6个月做十几个项目，四五个项目，还排除了技术学习的时间 

正儿八经，做一个比较成熟，有深度的项目，架构演进，1.0 -> 2.0 -> 3.0，解决了大量的问题，这才是一个项目，周期至少1~2年 

redis、mysql分库分表、mq、dubbo、spring cloud，hold住高并发的场景吗？ 

在过往的6个月里面，普通的培训课程，只是把这些技术一块一块的给学会了，敢说自己能到任何一个公司，那个项目并发量上万/s，你敢说自己就能Hold住？ 

那我觉得，第一，我觉得你hold住；第二，可能大部分自己都觉得自己虚，hold不住 

#### 真实项目驱动式的培训

我要说一下，我对这个架构班课程的，长达1年多，东西非常多，我随时还要加入很多的东西 

我的一个授课理念，思路，设想 

1、真实项目驱动，10几个项目，做一个项目，大项目，为期1年，1年多的这么一个项目 

2、完全真实的业务需求和场景，淘宝，京东，但是至少说，是我梳理过后，我认为是一个完整的电商的系统，可能里面会删减掉很多的细节，但是整体流程是完全可以跑通的。麻雀虽小，五脏俱全，一个项目。至少20个左右的服务。 

业务流程，业务需求，业务场景，整体的项目思路，基本就是按照完全真实的去做 

但是因为不可能说真的做出来一个京东商城，上千个人在做，所以会保留核心链路，黄金链路，砍掉一些琐碎和细节的需求 

3、按照一个大型项目，在1年期间完全真实的一个架构演进的过程去讲解 

完全按照真实的去走 

（1）一开始，就是几个哥儿们开始创业，做电商网站，卖东西。你就是一个架构师，带着2个小弟。其实就是用最简单的技术把整个这个电商网站的核心业务功能给做出来。技术架构可能就比较low，部署一台服务器。spring boot + mysql + tomcat + 一台阿里云服务器，就可以跑起来了。 

可能用户注册数量就10万个人，每天日活，活跃用户，一两万个，访问量就几十万，高峰期每秒并发在10/s左右 

在这个过程中，我们重点就将spring boot技术穿插在这个业务场景里面去讲解 

架构设计的流程，架构设计的几个视图，画哪些架构图，架构怎么去做设计，概要设计，详细设计，设计评审 

系统开发流程与规范，BAT公司的编码规范，BAT公司的单元测试规范，BAT公司的多环境测试规范（集成测试、功能测试、性能测试、并发测试、QA测试），BAT公司的上线发布规范，回滚规范，监控规范 

设计模式，如果是一个有经验的架构师，在一开始写业务代码的时候，就会很注重设计模式的使用，是落地在类图设计里的，在详细设计的阶段，架构师会去把握这块的东西 

代码如果用设计模式，复杂的业务，代码很优雅，在后面在这个代码基础之上，扩展新的功能和代码，都会很轻松，不需要大量的重构 

互联网公司实用型的项目管理方法，20人以内的一个项目，合理的管理，基本上都够了 

（2）后面用户量开始增加，增加到了百万级别的用户量，高峰并发可能就几百了 

而且业务功能不断快速迭代和增加，研发团队开始扩充，可能都扩充到了你一个架构师带了10个小弟 

针对这样的业务场景，需要做微服务化，拆分成多个服务，每个服务一台应用服务器，每个服务一个库，应对日益增长的并发量 

开始运用微服务+DevOps+敏捷开发+敏捷项目管理，去做 

为了解决的问题就是不断迭代的业务需求，不断增加的工程师数量，用上面那套东西如何去抗住百万级的用户访问量，同时将业务需求开发迭代速度支持到最快 

（3）用户量都到了千万级了，高并发了，每秒的并发可能都达到几千qps那样 

这套技术架构是撑不住的，整个大电商系统，要针对高并发做整体的架构改造，引入一系列的技术，redis缓存、mysql分库分表、mq、elasticsearch、nginx、集群 

（4）高可用，安全性，高稳定性，扩展性，伸缩性，架构问题，需要去解决 

（5）亿级用户量，亿级流量，整体架构更加复杂，为了解决亿级流量的访问，光是一个电商系统的购物车，就非常复杂 

（6）亿级流量了以后，一定会有基础架构组，这个时候会带着大家去研发自己的基础架构，基础中间件 

（7）一个公司到了这个程度之后，实际上就会开始做一些大数据的东西，带着大家去学习整个大数据技术栈的一些，java架构师如何将大数据技术栈融入自己的系统架构中 

我希望的是每个阶段到下一个阶段的时候，第一个阶段到第二个阶段（微服务阶段） 

我希望有一个真实业务场景中，承上启下的这么一个过程，就是说针对第一个阶段的系统架构，给大家真实的去演示他的一些问题，比如说能承载的qps太低了，或者是多个人在里面频繁修改代码，会导致整体的效率非常的底下 

从第二个阶段到第三个阶段（高并发阶段） 

比如说我要使用redis了，在整个架构中，我会先承上启下，给你去演示一下，现有的系统架构直接基于MySQL去搞，问题在哪里，可能就是撑不住一定的并发量，会跨掉，所以此时在什么什么环节要引入redis去重构这个架构，支撑更高的并发量 

（8）总结：完全真实业务，完全真实的购物流程，有一定复杂度的业务场景 -> 1年期间，完全真实的业务发展历程以及技术挑战 -> 完全真实的技术架构演进的过程 -> 所有的技术和架构，穿插在整个项目的过程中去讲解 -> 所有的技术完美的落地实践，与项目结合起来 -> 所有的技术在支持了业务需求之后，还要有足够深度的讲解，比如说spring boot，spring cloud源码的剖析

关于系统的模块组成，后期如何拆分，什么样的一个复杂程度，模拟多少人的团队，跟技术架构的讲解关系 

一开始的话呢，我们其实是没有子系统的概念，就是会带着大家用spring boot做一个单块应用，就一个工程 

到了后面，随着开发工程师多了，业务发展的很好 

会将一个系统拆分成多个系统，每个系统可以认为就是一个中心，比如商品中心，会员中心，订单中心 

在一个大型的电商公司里面，不同的团队负责一个中心，独立的一个10人的团队，专门负责商品中心，独立的一个团队负责会员中心，独立的一个团队开会负责订单中心 

这是一个非常大的公司了 

对我们而言的话，后面拆分的时候，主要是按中心来拆，你可以认为说是一个中心是一个子系统 

因为我是没法去演示几百个服务，要做的业务太多了，而且也不可能有实际那么多的服务器去部署那么多的服务 

一开始就是一个单块应用，中心，每个中心会包含一个或者多个服务 

那么后期拆分，实际上每个中心的服务会独立拆分为一个服务，但是呢，有多个服务是属于一个中心，就是一个虚拟的概念 

后面的话呢，演示的一个思路，可能就是说一个人维护一个中心，一个人维护一个或者多个服务那样子，10个人的团队 

因为会用项目驱动的方式，给大家演示团队的项目管理 

有上面说的那么一个程度的复杂的业务场景下，千万级用户的技术架构，还是亿级用户的技术架构，都可以演示了 

但是在技术架构的层面，我会完全按照那种几百个服务的大型电商系统的整体架构，给大家去讲解，技术架构

### 02_大型电商系统的整体架构分析

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0201.png)

电商分成几种 

（1）B2C：business to customer，企业对用户，天猫、京东，我们比如说在天猫和京东上买东西，都是直接从一个企业中购买的，比如说优衣库，天猫旗舰店，直接跟优衣库这个公司买的 

（2）C2C：customer to customer，中小型个体户，针对用户的一种售卖过程，淘宝。普通人，无力去自己创建一个所谓的品牌，无力去创建一个企业出来，在淘宝上开一个小店，类似于个体户，类似于在街边摆了煎饼摊子。淘宝上比如开一个衣服店，但是呢货是从亲戚家的一个厂房里批发来的，我们可以去买衣服，买了以后，店主可以通过快递，寄过来。 

（3）O2O：online to offline，美团，58到家，滴滴。除了购物以外的日常生活，比如说去饭店里吃饭，打车，叫保洁阿姨。以前可能就是纯offline，自己去找对应的餐厅，打出租车，自己去找小广告，找保洁阿姨。现在呢，可以通过一些手机app去预定一些服务，买团购券，打车，58到家上叫一个保洁阿姨，或者是保姆。 

我这里，要讲解的是最普通最通用的电商，B2C 

B2C又分成了两种： 

（1）电商网站，仅仅提供一个平台，然后呢实际卖东西的是第三方的一些公司和厂商，天猫，主要还是提供一个平台，让各种厂商入驻，在里面去卖东西 

（2）电商网站，自己去采购一些商品，然后呢自己对外售卖 

（3）实际上来说，现在大部分的B2C都是两者结合。京东，京东有自营，自己去采购商品，放到自己的仓库里面去，自己物流，去出售这个商品，一件衣服的采购价（100块钱），销售价（150块钱），50块钱差价；京东，也可以支持第三方厂商入驻的，在京东里面开店，京东是不管采购，不管库存，不管物流，最后那些第三方厂商将自己的商品拿出来售卖，客户付钱购买之后，第三方厂商负责发货，京东在里面抽成，拿一些服务费。 

我们这里讲解的电商的模式，是类似京东自营的这种B2C，太复杂了 

类京东自营的B2C电商，自己去采购商品，然后商品上架在网站里售卖，用户可以下单支付，网站自己从自己的仓库里发货，走物流商发货

#### 大型电商系统组成结构 

16个中心+32个服务 

1、完整的电商业务流程

2、足够真实的电商业务场景

3、足够复杂度的电商业务 

=> 我们讲解所有的技术和架构，足够了 

整体而言，电商后台系统分成3大块： 

1、管理后台：给公司内部各个部门使用的 

包含的部门包括：运营、采购、招商、财务、客服，等等 

包含的子系统包括：系统管理、采购管理、销售管理、库存管理、会员管理、商品管理、订单管理、客服管理、商家管理、财务管理、数据统计、供应商管理，等等 

2、商家后台：给入驻电商网站的商家使用的 

如果网站是自营商品，自行采购和售卖的话，是不存在入驻商家这一说法的，那么此时这块指的就不是商家，可能就是公司自己的商品售卖部门 

包含的子系统包括：店铺管理、商品管理、订单管理、营销管理、财务管理、客户管理、数据统计，等等 

3、WMS（仓储系统） 

因为一般公司的仓储工作人员，跟其他部门的工作人员，办公地点不是在一个地方的。公司总部一般在办公楼里面，而仓储工作人员一般在仓库里面。所以这个WMS系统可以单独拉出来 

4、8大核心模块 

商品、促销、购物车、订单、库存、物流、支付、会员 

1、管理后台 

1.1 系统管理 

这块主要是用来创建后台账号，分配权限，监控操作日志等操作的，一般只有整个电商后台系统的少数几个管理员，才有权限使用 

1.2 采购管理 

一般如果是自营的电商网站，都需要自己进行采购管理，核心是采购单，包含了采购计划、智能采购、供应商、仓库等信息，同时有采购入库和采购退货等核心流程，属于进销存中的“进” 

1.3 销售管理 

主要是针对网站中商品的销售设置的模块，包含了网站前台页面的CMS系统、专题页面、促销特卖活动、优惠券等等，都在这里，主要是针对如何让商品更好的售卖出去，属于进销存中的“销” 

1.4 库存管理 

主要是对商品的库存进行管理的，属于进销存中的“存” 

1.5 会员管理 

主要是进行会员体系的管理，同时针对用户进行数据收集、打标签、筛选，然后针对用户进行精准营销 

1.6 商品管理 

商品基本信息，包括了分类和品牌，等等；商品来源包括了网站自营和第三方商家 

包含了商品的新建/编辑，第三方商品审查，商品上下架，商品查询，商品管理（组合、定价、库存，等等） 

商品基础数据管理：类目、属性与品牌的管理 

1.7 订单管理 

主要是管理用户下的订单，包括订单流转，订单查询 

1.8 客服管理 

系统涵盖售前、售中、售后，售前是IM工具，售中是企业知识库，售后是工单系统 

1.9 商家管理 

商家入驻，商家信息管理，同时对商家店铺进行管理

1.10 财务管理 

退款、与第三方商家结算、与供应商结算、往来现金和账款的管理 

1.11 评价管理 

管理所有商品的评价数据 

1.12 数据统计 

看到流量、转化、交易、商品、用户、商家等各个维度的数据 

1.13 供应商管理 

2、WMS（仓储系统） 

2.1 系统设置 

设置仓库的基础信息，包括了商品、库位和设备，仓库人员账号、操作权限以及操作日志 

2.2 入库管理 

包括采购入库、调拨入库、退货入库、生产入库，有入库流程和入库单 

2.3 出库管理 

包括销售出库、调拨出库、采购退货出库，出库流程包括了出库单、捡货、验货、称重、出库 

2.4 库存管理 

管理商品库存数量，包括库存查询、库存盘点、库存预警、库存调整、库存同步，等等，库存数据和出库单和入库单关联在一起 

2.5 单据管理 

包括打印快递单、捡货单、发货单、小票、盘点单、调拨单 

3、商家后台 

3.1 店铺管理 

店铺信息设置、店铺装修、店铺子账号管理 

3.2 商品管理 

商家后台的商品管理和管理后台的商品管理，是关联起来的 

商家可以在这里发布商品、审查商品、商品分组、设置商品状态 

3.3 订单管理 

用户在电商网站支付之后，订单就会推送到商家后台，商家可以在这里看到订单信息，然后进行发货 

3.4 营销管理 

基于电商网站提供的营销渠道，比如搜索关键词竞价排名，可以推销自己的商品 

3.5 财务管理 

与电商网站进行财务结算相关的模块 

3.6 用户管理 

包括这个店铺的用户信息，以及售后问题处理，都在这里 

3.7 数据统计 

店铺的经营数据统计，都可以在这里看到

### 03_电商网站的完整购物黄金链路的分析

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0301.png)

4、电商系统整体运行流程 

4.1 自营商品进销存流程 

给自营商品部门开通账号权限 

自营商品部门在供应商管理模块中，录入供应商信息 

自营商品部门在商品管理模块创建自营商品信息 

接着通过采购管理模块，去创建一个采购单，此时采购单会走线下流程，由采购人员跟供应商去沟通，让供应商开始提供货物，供应商会通过物流商将商品运输到我们指定的仓库中去 

采购单会同步到调度中心去，调度中心会创建一个采购入库单，跟WMS系统通信，让WMS系统保存这个采购入库单 

走线下的物流，供应商的货物会运输到我们的仓库里面去，到仓库里之后，仓储工作人员，会负责将这些商品按照调度中心的指示，上到对应的货位上面去，这里要走一个线下的入库流程 

仓储工作人员，在货物都完成入库之后，会编辑一下这个采购入库单，采购入库单会让仓储管理人员去审核 

审核通过之后 

  一方面会走财务中心进行结算和打款

  另一方面会更新自己本地的商品库存、调度中心的商品库存、库存中心的商品库存，这个库存就可以在网站上看到了 

此时用户进入电商网站，就可以看到有库存可售卖的商品，同时对商品查看详情页信息，并且下单支付和购买，这里也会走系统的财务管理模块进行资金结算 

当然这里，网站的运营人员通过销售管理模块中的各种促销活动的设置，也可以对一些商品进行促销活动，也可以吸引用户过来购买 

用户下单时，会在订单管理模块中创建一个订单 

  创建订单时

  需要先从商品管理模块获取商品数据，从促销管理模块获取商品促销数据，从会员管理模块获取会员数据

  然后需要对库存管理模块中的商品库存数量进行锁定

  接着需要通过物流管理模块来计算运费

  最后通过上面所有的数据，可以生成一个订单出来 

接着用户对订单确认之后，可以进行支付，通过支付管理模块进行订单支付 

此时订单信息会同步打通WMS系统，创建一个出库单，此时仓储管理人员需要根据创建出来的出库单在仓库中进行出库流程（捡货、验货、称重、出库），然后走线下的物流流程，比如找第三方物流供应商，给他们快递单，让他们发货 

接着用户可以看到这个商品的物流状态，如果与物流系统打通，那么甚至可以查看到整个配送的全过程 

接着物流供应商就会将这个商品发送到用户手上 

如果用户拿到货之后需要退货，那么这个时候需要在网站上申请退货，此时会在客服系统中创建一个退货工单 

接着用户会通过线下物流服务商，将商品寄送回网站 

收到商品之后，售后人员需要验货，并且通过客服系统更新退货商品信息，同意退款，此时通过财务管理模块进行退款资金结算 

同时成功退款之后，售后人员还需要将商品退回仓库，此时仓库收到之后，会再开一个入库单，表明是退货入库，同时也会关联更新WMS的库存数量，以及管理后台库存管理模块中的库存信息 

非常典型的电商三流：信息流、物流、资金流 

如果以前你没搞过电商系统，光是看一些书的话，可能不理解什么是所谓的信息流、物流、资金流 

4.2 第三方商品进销存流程 

第三方商家通过网站提供的商家入驻申请流程，提交入驻申请 

此时入驻申请会转到管理后台中的商家管理模块中，在这里工作人员需要对入驻商家申请进行审核 

审核通过之后，就会自动为商家创建一个店铺出来，这个店铺里就包含了商家的基本信息 

然后商家就可以设置自己更多的一些信息，包括店铺的装修 

同时商家可以通过商家后台的商品管理功能，发布自己的商品，发布后的商品就会在网站上显示出阿里 

然后用户进入电商网站，就可以看到这些商品，同时下单支付和购买，此时会走财务资金结算，包括了与网站的资金结算，还有与第三方商家的资金结算 

同时这个订单信息会进入到商家后台的订单管理模块中 

商家会看到这个订单，然后从自己的仓储中捡货和发货，通过第三方物流发货到用后手中 

用户收到商品后，如果要申请退货，那么需要点击申请退货，此时会在商家后台的售后管理模块中显示售后信息 

然后用户需要将商品寄送回第三方商家指定的地址中 

第三方商家收到退货之后，需要执行退款，此时会走财务管理模块的结算，将款项退还到用户账号中

5、用户前台功能 

网站首页

注册与登录（认证）

搜索结果页

商品详情页

促销活动页

购物车

下单支付

已购买商品（查看发货状态、申请退货）

对商品发表评论 

补充说明 

1、我不是把我做过的大型的电商系统，拿出来给大家讲解。几千个，上万个工程师，在背后开发了几十个中心，大中台，前台，后台。 

2、我其实是根据我对电商的理解，从前到后，从后到前，理解。抽取出来的一个较为完整，较为真实的这么一个电商系统的完整架构，和完整的供应链到购物的链路和流程 

3、就是说，我觉得，业务需求和系统，跟我们后面要讲解的各种技术和架构反复思考和复盘过。就目前的这16个中心，32个服务，足以支撑后面所有的技术和架构的讲解。 

4、随着讲解的深入，到后面，可能会增加更多的中心和服务。促销，促销活动/优惠券。拼团，秒杀。支付中心，支付网关，对接多种第三方支付平台，资金清算，预警，很多东西。基于大数据的搜索系统。 

5、我目前设计出来的这个电商的整体从前到后，从后到前的流程 

（1）大家千万不要生搬硬套，我对很多的细节还是做了很多简化的处理的，有些同学以前做过小型电商网站，或者是以后可能也会去一些电商公司去工作，绝对不可能说跟我这个完全100%一样 

（2）我其实对整个这个架构和流程做了一些处理，简化的，架构完整，业务流程真实，可以跑通 

（3）有些同学如果做过电商，不要过来跟我死扣这个业务的细节，少了个什么，漏了个什么，有个流程感觉不是很对 

6、补充说一点，为什么说，不要直接拿着我的电商项目出去找工作 

（1）不要导致多个人的简历是一样的

（2）我讲课，很多业务细节被我简化掉了，你如果直接出去说这个项目，不懂电商的人可能还能忽悠一下。懂电商的，问一问具体的细节，你就完了

（3）我的架构班课程里，不只是提供课程，1对1指导每个人自己的项目经历，将技术和架构融入你熟悉的做过的业务领域中，工作履历的梳理和优化，简历怎么写，面试，职业生涯怎么走怎么发展 

7、对接下来十来讲做一个展望，至少是一个中心一个课时 

每个中心，会结合这个大的业务流程，去梳理里面的细节 

业务需求，实际上是要让我们参照着进行技术设计的，参照着这份东西，就可以设计出来对应的标结构 

每个中心的每个模块，我们都要去画模块的功能流程图，跟其他的外部子系统是在哪个环节，如何对接的，要提供哪些接口出去，传输什么数据，数据有哪些字段 

知道了这些以后，我们就可以参照着去进行架构设计了，详细设计，表结构设计 => 这些设计都是技术的东西，放在我们正式开始做开发的时候，我们就会按照这个我真实的项目研发的流程去走 

我们这个课程，就是梳理业务需求，梳理大的系统架构，购物流程，每个中心每个模块的需求（功能流程图、接口、数据传递、数据字段），纯业务，先把业务梳理清楚

### 04_权限中心的需求分析（权限管理、系统安全）

一、权限管理服务 

1、整体方案思路 

基于成熟的RBAC权限管理模型去做 

账号：其实就是电商公司里所有员工都需要具有的一个账号 

角色：通常是根据部门里的职位来划分，一个部门里的一个职位对应一个角色，比如会员运营、产品经理、售前客服、采购专员，等等 

权限：每个角色都分配对应的权限，权限实际上是3个东西（菜单、按钮、页面链接） 

我这里给大家说一个case，例子，就知道权限管理是干嘛的了 

就比如说采购部的采购专员，这是一个职位 

电商公司里肯定会招聘对应的采购专员 

（1）他应该是根据公司里预定的采购规划和流程，每隔一定时间，就会去采购一些商品。每个季度需要采购一批衣服，或者是什么鞋子，之类的东西 

（2）采购专员可能就会去创建采购单，使用采购中心里面的采购管理服务提供的对应的功能 

（3）采购单出来之后，他会打印出来那个采购单，然后跟对应的供应商去走线下的采购流程，说我要采购这些东西，你给我发货到什么仓库里面，每个商品采购多少件，采购价格是多少 

（4）采购专员会负责维护供应商的关系和数据

他需要使用电商系统里的哪些功能？ 

可以想到的一点是，他肯定不是说所有的功能都需要使用，同时有权限使用的。比如说订单中心，采购专员，公司里有哪些订单，跟他是没有关系的 

所以他是不能去搞这个订单的，查询公司里所有的订单，订单也是属于机密性的数据 

采购中心-供应商管理

采购中心-采购管理 

所以对于我们来说，权限管理，就是说，对公司里不同部门的员工，你给他一个账号 

比如说有个员工叫张三，分配一个账号，用户名一般是英文的，zhangsan。如果公司里有多个叫在张三的人，那么就按照先来后到的顺序，叫zhangsan01，zhangsan02，zhangsan45 

给他分配一个角色，叫做，采购专员，一般来说，对这种后台系统而言，角色都是跟部门的岗位相关联的 

采购专员，这个角色，我们给分配哪些权限呢？可以访问采购中心-供应商管理，这个菜单，对这个菜单出来的界面中，会有一些按钮，创建供应商，删除供应商，审核供应商，上传采购合同。对这个界面中的一些按钮，也可以分配权限，有没有权限去看到这个按钮。 

如果说按照最简单的理解，权限就是菜单和按钮，如果他没权限访问比如说订单中心-订单查询这个功能模块，那么这个菜单他直接就看不到。 

如果他没有权限在供应商管理界面中，执行删除供应商的操作，那么他就看不到删除供应商的那个按钮 

一个系统，他左侧的菜单栏+界面中的按钮，菜单和按钮，就是电商系统里所有的权限 

不同的岗位给分配不同的角色，不同的角色就有不同的权限，可以访问不同的菜单栏和不同的按钮 

注意点1：给某个账号分配了一个角色之后，可以在此之外，再额外选择授予该角色没有的权限 

权限没什么好说的，可能有的同学会觉得权限会比较复杂，根据一个具体的大型的集团公司里，设计一个复杂的权限系统 

一个通用的权限系统，就这样吧，我觉得这块，就是很多j2ee就业培训里，都会去讲解这个权限管理，CRUD和授权，认证 

我们的需求分析包括什么 

正儿八经，如果你干过码农，你应该知道一个角色，叫做产品经理，简称为PM，product manager

一般来说，都是产品经理会设计好一整套的系统的产品设计文档，不是我们来写的，产品经理来写的，对于我们而言，最主要的是去深刻理解产品经理写好的产品设计文档（PRD，Product Requirement Document） 

针对PRD做一个事情，叫做需求评审，这个需求评审，一般是怎么玩儿的呢？就是一个PM写好一份文档，然后在会议室里做一整天，给RD（Resource Developer），大型互联网公司里，常用的一些口头语。去讲解业务需求，PM在公司里会扮演我这个课程的一个角色。我现在就是在给大家去讲解这个具体的业务需求。这个事情实际上在公司里应该不是架构师、或者技术经理，是PM去干的。 

我在这里扮演了PM的角色 

PRD，有很多种形式，没有固定形式的，很多同学如果看了以后，不要去计较一些细节 

实际上根据公司的规范不同，行业不同，PM的经验和风格不同，PM的喜好不同，出来的产品设计文档，都是不一样的 

PRD，是没有固定格式的，随PM的情况和公司规范、行业不同去写 

但是一般来说，PRD主要就是定义清楚，这个产品的一个架构，包括了哪些功能模块，这个功能模块图，类似于我上上一讲，讲解的那个大图，就是一个电商系统架构图 

实际上那个图，一般在PRD里是第一个图，给人一个全景式的一个概览，包含了哪些功能模块 

然后一般PRD需要有另外一个图，完整的业务流程图，类似于我上一讲讲解的那个图，就是各个功能模块随着这个产品实际的用户使用场景，具体的一个流程是怎么样的，看了这个图，就知道这个系统的调用是如何流转的，具体是干嘛的 

对每个子系统，每个功能模块，都做具体的阐述和说明： 

（1）原型图，一般是PM用Axure去画的，原型图，就是那个后台系统的前端页面

（2）功能流程图，这个功能模块，整体的一个工作流程是什么，跟其他模块的交互关系是什么

（3）对功能流程图中的每个环节做详细的文字说明，流程中的每个环节，什么时候触发，具体要干什么，数据流转有哪些字段 

但是我这里做一点说明，我不画原型图，其实之前我们有学员给我反馈过，原型图画出来 

我规划了多少个模块，服务 

如果要我手画所有的原型图，类似一个PM那样，就这点儿工作量，估计得耗费我一个月 

原型图画起来很慢的，画图，是个慢工出细活儿，不是开玩笑的 

对每个功能模块：功能流程图，需求说明（要求是给出清晰的功能使用说明，还有每个环节的详细说明，还有每个数据的字段） 

那么我角色就足够了，我们是讲解的是java架构师，实际上来说，在真正的大公司里，前后端分离的，我们后端架构师，关注的主要是后端架构和技术，不是这个前端 

我们在这里，对前端页面，我们不做任何开发，纯粹凭借自己的想象，主要关注的功能执行的流程，数据的流转，业务的一些细节. 

2、需求分析 

2.1 权限管理 

需要去对权限进行增删改查，这是一个树形结构，比如：采购中心-供应商管理-添加供应商 

每个权限包含的字段都有：权限ID，权限编号（比如说PURCHASE，SUPPLIER_MGR，ADD_SUPPLIER），权限的名称（采购中心），父权限ID，URL（每个权限点击菜单，还是点击按钮，都会向一个URL发起请求），备注（COMMENT） 

用脑海去想象一下，对权限进行增删改查的时候，是要维护一个树形的东西的，比如添加一个子节点，编辑一个子节点，删除一个子节点，每个子节点就是一个权限 

如果要控制有些人登录之后，根据权限去显示左侧的菜单栏，树形的菜单，大家可以想象一下，怎么实现： 

（1）一个账号登录之后，根据这个账号分配到的角色以及对应的权限，查出来一个权限的集合。看一下里面根权限（父权限ID是NULL），那么就是左侧菜单栏的一级菜单（采购中心）。然后对每个一级菜单，去查询下面的 二级菜单（供应商管理、采购管理） 

（2）如果点击了一个菜单之后，会进入一个界面，对界面上的每个按钮，都需要根据是否有这个按钮的权限（添加供应商，ADD_SUPPLIER）去决定是否显示，查到这个账号是否对这个权限（ADD_SUPPLIER）的授权 

（3）也许你可以控制不显示出来一些菜单和按钮，但是有些为非作歹的人，也许会直接通过浏览器访问一个URL，来尝试进入某个界面，所以说对所有URL的访问请求，需要做权限控制，看一下他对那个URL是否有权限 

每次如果电商后台系统开发好了一个新的功能模块之后，都需要在这个权限管理中进行新增和配置，同时将权限分配给对应的角色 

根据实际的使用梳理出来对应的一些操作 

（1）左侧可以有一个菜单：权限中心-权限管理-权限管理 

（2）点击权限管理进入一个界面，看到的是一棵树，此时需要将整颗权限树给查询出来，显示在界面上 

（3）支持这个权限树的一个ajax异步加载，就是刚开始就是查询出来所有的根节点

（4）在前端页面上，点击一个节点，会将这个这个节点下面的直接子节点给查询出来 

（5）可以直接在前端界面上，对这颗权限树进行编辑，包括节点的增删改，就是可以对已有的节点，添加根节点，编辑一个节点的信息（点击那个节点，在右侧会出来一个表单，显示出来这个节点的具体信息），删除一个节点；还可以添加子节点；这个全部在前端做，跟我们没有关系 

（6）编辑完权限树之后，可以保存权限树，这个时候，我们需要对权限树进行保存，传递过来一个树形结构一个数据结构。我们需要对这个数据结构去进行遍历，看哪些是新增的节点，要插入；哪些节点被编辑过了，要修改；跟数据库中现在的权限树做一下对比，如果有节点被删除了，我们需要删除那些节点 

2.2 角色管理 

角色增删改查/状态的启用和停用 

角色包含的一些字段：角色ID，角色编号（PURCHASE_STAFF），角色名称（采购专员），备注，是否启用（启用，停用） 

每个角色，可以分配一些权限 

所以需要一个中间表，角色跟权限是多对多的 

角色-权限的中间表：ID，角色ID，权限ID 

（1）有一个菜单，权限中心-权限管理-角色管理 

（2）点击角色管理，进入一个角色列表页面，这个页面里，展示出来角色所有的字段，是支持对角色列表分页查询，支持条件筛选（角色编号，角色名称，是否启用） 

（3）角色列表上面有一个按钮，叫做添加角色，点击，会进入一个添加角色的界面，一个表单，在里面可以去填写角色的一个信息；添加角色的界面上，还会出来一颗权限树，在这个树上可以去勾选，要分配给这个角色的权限 

（4）点击保存，可以执行一个添加角色的操作，包括角色自己的信息插入表中，然后角色跟各个权限的关联关系，插入那个中间表中 

（5）在这个角色列表中，最右侧一栏，是操作栏，有编辑按钮，点击之后，会进入一个表单，此时会回显出来角色的信息，以及权限树种会回显已经给角色分配的权限，会打钩。在这里可以进行编辑 

（6）保存编辑之后，我们要提供一个编辑角色的操作，将角色的基本信息更新到数据库中，同时更新中间表中的角色跟权限的关联关系 

（7）在角色列表中，有一个删除按钮，可以删除这个角色，就直接将角色和角色的授权数据都删除 

（8）在角色列表中，有启动/停用的按钮，启用或者停用，就是更新角色的一个是否启用的一个字段 

（9）为账号列表的筛选，提供一个查询全部角色的一个功能 

2.3 账号管理 

（1）账号列表 

包含字段：ID、用户名、姓名、电话、创建人、创建时间、备注、启用状态 

（2）账号列表 

有一个菜单，权限中心-权限管理-账号管理 

支持账号列表的分页查询 

用户名、姓名、电话、角色（下拉框）、创建时间（时间范围）、启用状态（下拉框） 

（3）添加账号 

在账号列表的上面有一个按钮 

基本信息：用户名、密码、姓名、电话、启用状态 

分配角色：会出现一个角色列表，可以分页查询，可以按条件筛选，支持复选，选择多个角色 

额外分配权限：权限树，随着你勾选不同的角色，会支持将那个角色拥有的权限，在下面的权限树种显示出来。可以额外的去勾选更多的权限 

在后台，需要保存账号的基本信息，保存账号-角色的关系（中间表），保存账号-权限的关系（中间表）
 （3）编辑账号 

基本信息与权限信息，在每一个账号最右侧的操作栏 

进入一个编辑页面，可以回显所有的数据，显示账号的基本信息，显示账号的分配的角色，在列表中的复选框会自动勾选，显示账号关联的权限，权限树里的复选框会自动勾选 

然后可以编辑 

保存，编辑账号，更新账号数据，更新账号和角色的关联关系，更新账号和权限的关联关系 

（4）启用/停用账号 

修改账号的启用状态 

（5）修改密码 

修改账号的登录密码，在每一个账号最右侧的操作栏 

2.4 权限控制 

（1）在左侧菜单栏，先查出来一个账号关联的所有权限中的顶级权限（父权限ID为NULL），再查出来每个顶级权限下面，这个账号有权限的二级权限，两级的左侧菜单就可以显示出来了 

（2）点击一个菜单，跟着URL进入一个界面之后，显示按钮的时候，需要根据按钮对应的权限的编号，去后台查一下，那个账号是否拥有某个权限，是这个编号的 

（3）所有的URL请求，全部看一下，这个账号授权的权限中，是否某个权限的URL是这个URL，账号是否有权限访问这个URL 

子系统-服务-模块-功能，这样的一个结构 

二、系统安全服务 

菜单：权限中心-系统安全-操作日志 

1、业务知识 

每个账号在执行各种操作的时候，都会访问后台系统的URL，账号对这些URL的访问，就是操作日志，可以存储下来，以后如果对一些非法的员工，可以去审计他的行为，看他都在干什么 

2、操作日志的数据字段 

ID、账号ID、IP地址、URL、权限ID、操作时间、是否授权（是/否） 

3、添加操作日志 

就是说账号在访问所有的URL的时候，都会去添加一条这个操作日志，插入一个表中 

4、查看操作日志 

显示的列表字段：ID、账号ID、用户名、姓名、IP地址、权限名称、权限编号、权限URL、操作时间、是否授权 

可以筛选，账号ID、用户名、姓名、IP地址、权限名称、权限编号、权限URL、操作时间范围、是否授权（下拉框） 

菜单：权限中心-系统安全-黑名单 

1、业务知识 

可能会受到一个攻击，或者不明的ip在访问我们的URL 

2、查看黑名单列表 

ip地址、备注 

3、对黑名单进行增删改 

4、黑名单的控制 

黑名单中的ip地址，所有的访问一律封禁

### 05_商品中心的需求分析（类目、属性、品牌、商品管理）

1、业务知识

这边正好给大家讲解一下，我们之前会看到各种各样的打着所谓的电商旗号的一些demo级的项目，商品数据，但是多非常非常的简单 

专业的电商系统里，商品、订单、支付、库存，这几块都是很复杂的 

SKU：Stock Keeping Unit，最小库存单位，最小的商品单位，比如iPhone 7 Plus 128G 银色，就是一个SKU 

Apple iPhone X (A1865) 64GB 深空灰色 => SKU，SKU一定是可以唯一定位到一个实际的商品上的 

Apple iPhone X，它是一个SKU吗？没法唯一定位到一个具体的商品上，它的不同配置的手机，有不同的颜色，有不同的内存，你只有选择了一个颜色+内存，才可以唯一定位一个iphone x的手机 

SPU：Standard Product Unit，产品单元组合，比如iPhone 7 Plus，就是一个SPU，其实类似一个商品的概念吧。但是iPhone 7 Plus是不能具体指代哪个商品的，因为iPhone 7 Plus有很多种，比如不同的内存大小+不同的颜色，就可以组成不同的手机 

我们一般来说，所说的一个商品，我们指的是什么呢？说的是一个SPU，我们都会说，我要买一个iphone x，我们一般不会说要去买一个深灰色32GB的iphone x。 

SKU也可以叫做一个商品，SKU和SPU之间的关系，具体的一个商品，可以定位到一个实体的这么一个商品 

比如iPhone 7 Plus这个SPU为例，有6种颜色（金色、白色、黑色、玫瑰金、银色、亮黑、红色），3种内存大小（32G、128G、256G），所以这个SPU下的SKU有6 * 3 = 18种组合。比如说iPhone 7 Plus 玫瑰金 32G，iPhone 7 Plus 红色 128G，这就是2个SKU 

一个SPU下，有4个SKU，颜色（深空灰色、银色），内存（64G，256G），2 * 2 = 4种组合，4个SKU 

深空灰色+64G，是一个具体的手机

深空灰色+256G，是一个具体的手机

银色+64G，是一个具体的手机

银色+256G，是一个具体的手机 

通常我们说的商品，实际上就是一个SPU 

我这边还得说一下，我这里采取的是类似天猫的那种方式，就是一个商品详情页，显示一个SPU。通过参数的组合选择，可以让用户自己选择和唯一定位一个SKU。 

不同的电商，都不一样，业务层面 

类目：就是SKU所属的分类 

属性：关键属性、销售属性、非关键属性、导购属性，4种。 

关键属性是能唯一确定一个商品的属性，比如说之前提到的手机，那么关键属性可能就有屏幕尺寸、型号，这个是可以唯一确定一个商品的，也就是一个SPU，比如说iPhone 7 Plus，7 Plus就是个型号，这就是一个关键属性，可以确定一个商品了 

iPhone 7 Plus，关键属性，2个，品牌（Apple），型号（iPhone 7 Plus） => 可以定位出来一个SPU 

销售属性，是说确定一个SKU的属性，比如手机的销售属性，就有颜色、内存，比如iPhone 7 Plus 128G 土豪金，就可以确定一个SKU了 => 用来定位SKU 

非关键属性，就是除了关键属性和销售属性之外的其他属性，比如手机就有摄像头像素、接口类型（USB），等等很多 

导购属性，可以用来在商品列表页中作为筛选条件的 

那么我们这里可以想象一下，在京东、淘宝等电商详情页中，看到的是什么？实际上看到的单位就是一个SPU，然后我们需要对这个SPU，对它的销售属性选择对应的值，相当于就是选择了一个具体的要购买的SKU 

而这个SPU，它的关键属性，就确定了它自己本身是一个SPU；销售属性是在商品详情页由用户来选择的；非关键属性实际上是一个SPU的所有SKU都共享的，都是一样的，实际就是所谓的商品规格；导购属性就是这个SPU的可用来进行导购筛选的属性，可以是关键属性、销售属性、非关键属性，都可以 

然后的话呢，是这样的，类目实际上也是一个树形的结构 

父类目（服装） -> 子类目（女装） -> 叶子类目（连衣裙） 

就是这个类目，一般就是3~4层，就可以了，不要层级太多，甚至在前台显示的时候，可以省去第一季的类目，就显示第二级和第三级的类目 

然后每个叶子类目，会关联一堆属性（4种属性） 

在添加商品的时候，给这个商品选择一种叶子类目，然后就会让你输入对应的属性值 

就举个例子吧，比如说，电子产品 -> 手机 -> 智能手机 

比如说，智能手机这个叶子类目，就关联了一堆的属性 

（1）关键属性：品牌，型号

（2）销售属性：颜色（红色，白色，蓝色，土豪金），存储容量（4G，8G，16G，32G，64G）

（3）非关键属性：拍照功能（摄像头像素、摄像头类型、视频显示格式），显示（屏幕尺寸、触摸屏类型、分辨率），网络（网络类型、网络模式）

（4）导购属性：存储容量、网络类型、摄像头像素 

我们在创建一个商品的时候 

选择一个类目：电子产品 -> 手机 -> 智能手机 

输入一个品牌：Apple 

输入关键属性：品牌（Apple），型号（iPhone 7 Plus） 

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G） 

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版） 

导购属性：不需要输入的 

商品名称：苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机 

你会发现什么，商品的核心数据，基本都出来了 

1、属性管理 

属性的增删改查 

这块就是对属性进行管理，先要有属性信息，包括了名称和描述，以及输入方式（多选，输入），如果是单选/多选，需要给出对应的几个选项 

名称、描述、输入方式（多选、输入）、可选值范围 

名称：机身颜色

描述：手机机身的颜色

输入方式：多选

可选值范围：白色、蓝色、红色、土豪金、灰色 

2、类目管理 

类目的基本字段：ID、名称、描述、父类目ID、是否叶子类目 

进入界面，显示一颗类目树（可以点击异步加载子树），类目树子节点新增/编辑 

类目属性管理（新增/编辑属性分组，属性分组添加/删除属性） 

一个类目可以直接关联一些属性，也可以直接关联一个属性组，每个属性组里关联多个属性 

这个基础类目很重要，比如说手机就是一个基础类目，同时这个基础类目有多个属性（前摄像头像素、后摄像头像素、屏幕尺寸、网络制式），选择一个手机类目，同时输入多个类目属性的值，就可以唯一确定一个商品；再比如说一个裤子类目，类目属性就是腰围，裤长，面料材质，厚度 

类目是一个大的类别，但是光有类目不行啊，决定这个类目下一个唯一商品，需要使用类目对应的多个关键属性的值，来确定一个商品 

维护属性的时候，需要对这个属性选择对应的所属类型，可以支持多选，一个属性可以是多种类型，比如可以是销售属性，同时也可以是导购属性 

属性有不同的类别，有关键属性、非关键属性，销售属性，导购属性。关键属性，比如手机的品牌和型号，衣服的品牌和货号，都可以唯一确定一种商品，定位一个SPU；基本属性就是显示在商品规格中的普通属性；销售属性是指的比如衣服的多种颜色，多种尺码，算是一个商品的不同型号，可以唯一定位一个SKU，一般显示在商品信息那块；导购属性，是可以用在商品列表页，进行筛选的属性，可以看一下商品列表页 

这里说一点，分类的属性，是只能选择已经有的属性的，选择的同时，可以勾选是否必填，属性分组。属性分组的概念，就是将多个属性分为一组，比如商品规格里面，就分为了多个组，随便找个商品看看，然后在分组里可以增删改查属性 

这里还有一个属性继承的概念，比如对类目A有1个属性；类目B是类目A的子类目，有1个属性；类目C是类目B的子类目，也有1个属性；那么如果最后在类目C下创建SKU，则会包含1+1+1=3个属性，这是一个属性继承的概念 

类目树可以管理，每个类目管理的属性，可以通过较为复杂的前端操作去关联 

每个类目可以直接关联属性，也可以关联属性组（每个属性组里关联多个属性），关联每个属性的时候，需要给属性选择类型（支持多选） 

类目之间的属性继承关系 

父类目，比如电子产品，有一个属性（操作系统）；手机，有一个属性（机身颜色）；智能手机（触摸屏类型） 

实际上，在智能手机下面添加商品的时候，是会让你输入三个属性的（操作系统+机身颜色+触摸屏类型） 

3、品牌管理 

品牌的增删改查 

这里的信息包括了：中文名、英文名、别名、logo、品牌介绍、品牌授权凭证、是否启用、产地、备注 

做一点特殊说明 

两种类目：前台类目，后台类目 

后台类目：可能是3级的，服装 -> 女装 -> 连衣裙 

前天类目：不想给那么多的层级，希望让用户更好的去选择，女装 -> 连衣裙 

如果商品按照多层级的后台类目在前台进行展示，那么可能很用户搜索的时候就太麻烦了，可能比如在后台类目有3个层级，在前台类目就只要2个层级，此时就需要单独维护一套前台类目，然后跟后台类目进行关联映射 

前台分类管理：分类节点新增/编辑，分类节点排序，分类商品聚合（按基础类目、按品牌、按属性） 

前台类目，一样就是一棵树，不用维护属性；主要是将前台类目，每个层级的类目，都要关联到一个后台的类目上去 

前台类目，我这里就不做了 

4、商品管理模块 

4.1 新建/编辑商品 

维护好了基础数据，包括属性，基础类目，品牌，就可以编辑商品了 

商品从创建到上架可以售卖，是有一个流程的 

商品新增编辑 

商品信息 

类目：在一颗类目树种，去选择一个对应的叶子类目，手机 

品牌：在一个列表框中，可以去选择一个品牌，Apple 

商品编号：每个商品都有一个编号 

商品名称：输入，苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机 

商品副名称：输入，当天发 送壳膜 咨询客服不分期价格直降 

毛重：输入，100g 

商品状态：核待审、待上架、审核未通过、已上架、已删除 

外包装长：50cm

外包装宽：100cm

外包装高：200cm 

服务保障：这里其实是可以去选择的。但是我们简化一下，就直接输入。碎屏无忧，全国联保，正品保证，极速退款，赠运费险，7天无理由退换，可开发票 

商品图片：上传商品的一些图片 

商品描述：一般是富文本编辑框，图文混排，插入图片，插入文字 

包装清单： 

采用 Lightning 接头的 EarPods  1 件

iPhone  1 件

Lightning 至 USB 连接线  1 件

5W USB 电源适配器  1 件

Lightning 至 3.5 毫米耳机插孔转换器  1 件 

类目属性值（输入选择的类目的各个属性的值，注意，这里实际就是输入关键属性值和非关键属性值，是一个SPU共享的，但是SKU的销售属性是对每个属性都选择多个值，比如有哪集中颜色，哪几种内存大小） 

输入关键属性：品牌（Apple），型号（iPhone 7 Plus） 

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G） 

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版） 

运费（选择物流运费模板，比如是包邮/按重量/按件，后面下订单计算运费的时候都是根据运费模板来计算的） 

库存（所属仓库（石家庄仓库）、库存数量（0件）、库存状态（是否有库存，无库存）、最低预警库存（1000件）） 

商品价格（采购价（8000元）、参考价（8500元）、售价（关联会员体系，不用的会员级别不同的价格，1级会员是8500元，2级会员是8450元，3级会员是8400元，4级会员是8350元，5级会员是8300元）、特殊促销价格（8100元）） 

特别说明：在选择好销售属性的值之后，会自动出来各个销售属性排列组合出来的SKU，对每个SKU，可以具体设置对应的价格和库存；但是也可以对这个SPU设置统一的库存和价格 

4.2 商品的审核 

需要由商品部门的管理人员对这个商品的内容进行审核，内容以及售价 

4.3 审核通过之后，商品的上架和下架 

4.4 商品列表的查询 

列表字段：类目、品牌、商品编号、商品名称、商品状态、所属仓库、库存数量、库存状态、采购价、参考价 

筛选条件：类目、品牌、商品编号、商品名称、库存数量范围、参考价范围 

操作栏：编辑、审核、上架/下架、删除 

16个中心，24个服务，一开始，加入更多的中心和服务 

高并发、大数据量、高可用、高性能、高稳定性、中间件、亿级流量，业务和场景都够了 

我大概考虑了一下，几乎后面要涉及到的所有的技术，都可以非常好的使用这种模拟真实的业务场景去带着大家实践 

举个例子，比如redis，你说你去单纯的学习redis有什么用呢？ 

最重要的还是要结合实际的业务场景，你的redis，在复杂的业务场景怎么去用 

mq，在这种系统里面，怎么去用

### 06_WMS（仓储管理系统）的需求分析

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0601.png)

1、业务知识

主要是调度中心会负责跟WMS系统进行交互，电商系统其他服务都是跟调度中心进行交互 

实际上来说，电商的系统，WMS系统，仓储管理系统，有几种情况，可以是那种C/S架构的，安装在仓库里面的，第三方提供的专业的仓库管理系统 

我们开发的电商系统可以跟WMS进行通信即可 

但是这里呢，我们采取的是我们自己开发一套WMS系统，WMS系统，我们做成什么架构的 

B/S架构，C/S架构 

B/S架构：每个仓库的管理人员，直接通过一个浏览器，就可以看到自己的仓库里面的一些数据和信息，包括其他仓库的一些数据 

C/S架构：需要在每个仓库里面去安装，一般就是只能看到自己的仓库里的一些数据 

B/S架构：假设认定为，我们这个B2C电商，WMS系统自己开发，B/S架构，可能我们本来就没几个仓库，假设我们搞了几个重要的仓库。石家庄仓库、杭州仓库、广州仓库，负责发货到全国各地。 

然后呢，每个仓库的人，都可以看到所有仓库里面所有的数据 

下面讲解一下比较重要的一些概念 

（1）仓库：管理仓库信息，CRUD 

（2）货位：每个仓库里面，要去管理货位的信息，CRUD，（我们可以想象一下，货位是什么，每个仓库里划分成了很多排货架，一般是分成一排一排的，比如A排；每一排有多个货架，比如A01货架；每个货架有多层，每一层有多个货位，比如A01-1-01） 

（1）入库：采购入库、退货入库、调拨入库，等等 

（2）出库：销售出库、调拨出库，等等 

每次一批商品入库，都会关联一个货位，或者是多个货位 

每次商品要出库的时候，拣货单多会关联一个货位，然后方便仓库工作人员直接到对应的货位去拣货 

2、仓库管理模块 

对仓库信息进行增删改查 

仓库信息的字段：ID、仓库编号、仓库名称、仓库地址、联系人、联系电话、启用状态、备注 

3、货位管理模块 

进入一个货位的列表，上面肯定有一个下拉框，是仓库下拉框，默认选中了一个仓库，显示的是某个仓库的货位列表 

在这个货位列表中进行CRUD 

提供货位的增删改查功能，包括的字段有 

所属的仓库ID、货位编号（A01-1-01）、创建人、创建时间、启用状态、存放总容量（简单一点，就按照件数来算好了，一般来说这块会更加的复杂，可能是按照商品的体积）、剩余容量 

我们可以想象一下，实际上后面讲到在采购商品的时候，你采购了一批商品，然后呢，那批商品，在调度中心里面，调度中心会负责去进行商品入库的调度，就是说，采购了1万件衣服 

调度中心会看一下当前每个货位的剩余容量，每个货位最多可以放1000件衣服 

调度中心会按照一定的规则，将1万件衣服，分配到10个货位中去，每个货位放1000件衣服 

4、商品入库 

（1）到货确认：在商品到了仓库之后，可以进行到货确认

（2）验货打码：检查商品是否合格，同时进行打印出商品条码，贴在商品上

（3）商品上架：按照先进先出的原则，将商品分配和上到对应的货位上去 

上面说的几个步骤是线下实际上在仓库里执行的商品上架的一个流程 

但是在系统中，数据的流转，等到后面讲采购的时候我们一起讲解 

5、商品出库 

一个用户下了一个订单，这个订单的不同的商品会被调度中心，调度到一些仓库里去发货，此时仓库工作人员会收到一个销售出库单，调度中心也标识出了，哪些商品从哪个货位上面去出库，发货 

（1）调度 

锁定库位，跟物流公司进行通信，申请发货物流单号，然后为订单分配一个物流单号 

库位锁定的原则是先进先出，商品入库上架的时候也是先进先出的，这样可以保证商品发货的顺序性 

这里是什么意思，假如说我们2017-01-01进了1万件衣服；2017-02-01又进了1万件衣服；发货的时候，先进先出，优先发2017-01-01进的衣服 

这里锁定的是货位库存，就是每个货位这个商品有多少库存 

（2）打单 

打印发货单、物流单 

你平时网上购物的时候会发现有2个单子 

发货单是放在包裹里面的，告诉你本次发货了哪些东西；物流单是贴在包裹上面的 

发货单，实际上是调度中心直接就给创建好了 

物流单，是调度中心跟第三方物流厂商的系统进行通信，直接申请了一个物流单 

调度中心，发货单（发了哪些商品，商品清单），物流单（哪个物流商，运送到哪儿），商品出库单（调度，从哪个仓库，发送哪些商品，从哪些货位去拣货，物流商是谁） 

（3）捡货 

销售出库单 

女士羊毛衫，从货位A01-2-05，去拿2件

男士袜子，从货位A05-5-09，去拿10件 

就是工作人员推着捡货车去捡货，然后捡货之后会扣减锁定的货位库存 

（4）复核

对捡货完成的订单进行核对，确保发货单、实物商品、物流单的统一 

（5）包装 

对复核完的商品进行打包和称重，发货单放包裹里面，物流单贴包裹上面 

（6）交接发货 

根据物流单将打包好的商品推送到仓库里面，仓库外面，跟物流公司的交接区，接着物流公司会按照物流单去进行发货 

在线下的一个销售出库的这么一个过程 

我们这次，第一个版本，重点做WMS的仓库管理、货位管理、采购入库、销售出库、退货入库 

6、库存调拨 

我在这里这么说一句，我们这个系统是分版本的，第一个版本，我们就完成核心的功能，每个模块，中心，会员、促销、WMS、支付、订单、商品，我们都留一些业务模块，到后面去做 

为什么呢？ 

因为后面，在进入微服务架构之前，我们要给大家用真实的多模块同时十几个人，并行开发真实的业务需求，迭代业务需求，此时互相之间排期冲突、上线冲突、代码冲突，等等各种问题 

单体应用的话，十几个人，同时给十几个模块加功能，排期不一样，上线时间布一样，测试时间布一样，大量的冲突，导致互相等待，迭代效率低下 

==> 微服务架构，优雅，漂亮，引出来 

还有另外一个，其实是什么呢？我们预留一些功能模块，到后面可能要讲解某个具体的技术，或者是架构的时候，专门来引入那个业务功能，基于那个特殊的业务功能来讲解某个架构 

促销模块，秒杀，促销活动，优惠券 ==> 秒杀，是放到后面去讲的，是为了讲解瞬时超高并发架构去讲解的 

仓内调拨：将部分商品从一些货位里调拨到其他一些货位，让货位负载均衡，方便拣货

仓间调拨：从一个仓库调拨部分商品到另外一个仓库中 

仓库工作人员进行调拨单开单，此时状态是编辑中，编辑后调拨单状态变为待审核。调拨单中需要选择要调拨的商品以及数量 

调拨单的信息包括：调出仓库（下拉框选择），调入仓库（下拉框选择），物流公司，物流单号，备注信息，然后就是添加商品，商品列表包括了sku编码、商品名称、规格、可调拨数量（该仓库的库存）、调拨数量、调出货位、调入货位（下拉框选择） 

调拨单的列表包括了以下的字段：调拨单号、调拨单状态、调出仓库、调入仓库、商品种类、调拨开单量、已出库总量、已入库总量 

仓库管理人员对调拨单进行审核，如果审核通过，则状态变为已审核；如果审核不通过，则状态回到编辑中 

审核通过的调拨单，会分配给对应调出仓库的工作人员处理，此时调出仓库的工作人员，可以根据分配过来的调拨单，创建调拨出库单，调拨出库单开单之后，状态是编辑中，保存之后变为待审核，同时此时调拨单的状态变为待出库 

仓库管理人员需要对调拨出库单进行审核，审核之后状态变为已出库，同时调拨单的状态变为已出库，同时仓库开始进行调拨的线下物流操作，往调入仓库运输 

调入仓库接收到运输过来的商品之后，根据调度出库单创建一个调拨入库单，此时状态是编辑中，编辑过后，状态变为待审核，此时调拨单的状态变为待入库 

调入仓库管理人员对调拨入库单进行审核，审核之后，入库单状态变为已完成，调拨单的状态也变为已完成 

同时这个时候开始执行商品入库的操作，包括验货、称重、上架，等等 

7、库存盘点 

如果线下入库出库流程与线上的入库单以及出库单不相符，那么可以进行库存盘点，盘点之后可以自动生成盘盈入库单和盘亏出库单 

仓库工作人员，创建盘点单，此时状态是编辑中，编辑之后，状态变为待审核 

这里选择要盘点的仓库，同时添加仓库里的sku商品进去，商品列表字段包括了：sku编码、商品名称、规格、货位、库存数量 

盘点单列表字段包括了：盘点单号、盘点单状态、仓库、商品种类、备注 

仓库管理人员，对盘点单进行审核，审核通过之后，盘点单状态变为待盘点；审核不通过，盘点单状态变为编辑中 

接着仓库工作人员开始对盘点单进行录入操作，就是要盘点的商品的实际库存数量，录入结束之后，盘点单状态变为已完成 

接着系统自动对盘点单中的系统库存数量以及实际盘点库存数量进行比对，如果库存数量一致，则保持盘点单状态为已完成，会生成盘点盈亏表 

如果库存数量不一致，比如实际库存数量比系统库存数量要少，此时要自动生成盘盈入库单；如果实际库存数量比系统库存数量要多，此时要自动生成盘亏出库单 

此时可以将盘盈入库单发给供货商，让他们补货；也可以根据盘亏出库单，通过线下物流向供应商退货

### 07_商品采购核心流程以及关联多个中心的需求分析

#### 07_01_采购中心_供应商管理_需求分析 

之前已经跟大家都说过了，WMS系统，仓库，仓库和货位的概念 

商品入库和出库的线下的流程，我们基本都清楚了 

1、供应商管理 

CRUD 

新建供应商、供应商列表 

供应商信息 

（1）基本信息：供应商名称、公司名称、联系人信息（公司地址、联系人、电话）、供应商类型（自营、第三方）

（2）结算信息：报价币种、结算方式（预付款、账期（月结算，周结算，季度结算））、结算账户（银行名称、银行账号、开户名称）、开票信息（名称、银行、纳税人识别号、联系电话）

（3）经营范围：品类、品牌（这个是从商品中心去选择的，类目和品牌的基础数据）

（4）其他：备注、公司资质信息、启用状态

（5）合同资料：合同资料信息（合作合同、商品协议价合同、采购合同）、每个合同到期时间 

另外提一句，之前有同学问我，能不能个我用axure去画原型图，大家可以想象一下，这么多模块，这么多的东西，至少几个礼拜才能把这些图画好 

我们现在就是纯讲业务流程和需求细节，都十几个小时了 

如果还要一张原型图一张原型图的去画，那就是几个礼拜 

我们是有经验的java RD，这里至少都是工作过一两年以上的，你只要实际在公司里做过java开发，对这种CRUD类的图形，界面，都很熟悉 

我不是针对那种没毕业，或者没有实际java工作经验的同学去讲解的，都是有经验的同学，前端界面里的CRUD的东西，都应该比较熟悉，特别是有些同学说，干了很多年CRUD，都快吐了 

2、供应商绩效管理 

产品质量、交货期、交货量，简化一下，采取3个指标来评估一个供应商的等级 

就是每次供应商发货到仓库的时候，仓库工作人员都会去验货，都会对这次商品的入库单，加一个确认的一个过程，输入产品质量（良品率）、交货期是否如期（有没有延期）、交货量（如否量是准确的，没有缺货） 

这个每次交货的确认记录，会回传导供应商管理的模块中，会存储下来每个供应商的交货记录，作为后面对供应商等级进行考评的一个依据 

A、B、C、D 

每隔3个月，都对供应商最近3个月内的交货记录，进行考评，比如说给一个权重 

每次交货都是100分，产品质量占到了40%，交货是否如期占到了30%，交货是否足量占到了30% 

就是可以通过产品良品率 * 40分，拿到一个分数；交货是否如期，30分全拿，延期1天，扣10分，延期3天，全部扣光；按照交货的足量率，我要采购100件衣服，你给我发来了80件，80%的分数，30分 * 80%， 24分 

对最近3个月每次交货都打一个分数，最后将每次交货的分数算一个平均分出来 

就是这个供应商最近一个季度的分数 

按照分数的范围给供应商评级，100分是A级；90分是B级；80分是C级；80分以下都是D级

#### 07_02_采购中心_采购管理_需求分析 

1、采购业务流程 

供应商的菜单，采购中心-供应商-供应商管理，采购中心-供应商-供应商绩效管理 

有一个菜单，采购中心-采购-采购管理，进入一个界面，看到一个采购单的列表，点击一个按钮，创建采购单 

采购单：供应商，商品，仓库 

采购部的工作人员创建一个采购单，输入了采购单的内容，此时状态是编辑中；接下来，采购人员可以对采购单多次修改，感觉差不多，都完善了以后，可以对采购单提交审核；此时状态是待审核；也可以在这个阶段取消采购单，那么状态就是已取消 

采购部的主管对采购单进行审核，状态可以是已审核，如果审核不通过则回到编辑中的状态 

通过审核之后的采购单同时会发送给供应商，供应商根据采购单将商品运输至仓库 

采购单同样会发送给调度中心，调度中心会生成采购入库单，然后下发给WMS系统。采购入库单中，包含了，告诉这个仓库，包含了采购单所有的数据，然后更重要的是，要根据仓库中的每个货位的剩余容量，去将每个商品去分配到对应的货位中去 

比如说采购单里有一个商品：iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台 

然后在采购入库单中，会对商品的入库进行调度，会看一下这个商品的采购数量，比如说是1200台，那么一个货位的存储容量假设是600台 

这个时候，采购入库单中，会将一个商品拆分为两个 

iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台，上架数量600台，货位是A01-1-01

iPhone 7 Plus 128G 土豪金，采购价格6000元，采购数量1200台，上架数量600台，货位是A01-1-02 

就是说，做的比较好的电商系统，它都是至少要保证说，商品入库和出库，都是要关联具体的货位的。入库的时候知道放哪个货位，出库的时候知道从哪个货位去取。这个过程就是调度中心在干 

供应商发货到仓库，仓库收到商品之后，仓储工作人员，需要进行验货：抽查商品质量、输入到货日期、检查商品数量 

此时采购入库单的状态是编辑中，然后仓库工作人员可以对采购入库单进行编辑，输入上面的三个数据，点击保存，此时还是编辑中的一个状态 

同时仓库工作人员需要对照着采购入库单，进行验货、入库、配货、上架等仓库操作，完成实际的入库操作 

仓储工作人员完成商品上架之后，对入库单提交审核，由仓储管理人员进行审核。当入库单状态变为待审核之后，会同步将采购单的状态变为待入库 

在入库操作完成之后，接着入库单需要由仓库管理人员进行审核，审核通过之后，状态变为已入库，同时采购单的状态也变为已入库；如果审核不通过，则状态变为编辑中 

接着财务人员需要进行结算，WMS系统会同步跟财务中心通信，发送已入库的采购入库单过去，然后财务中心基于入库单创建一个采购结算单，此时状态是编辑中；如果此时取消，那么结算单状态变为已取消 

采购结算单包含了哪些数据：包含了采购单的核心数据，总金额，商品金额，物流费用，还会从供应商管理模块中查询出来对应的一些结算数据 

然后财务人员可以对结算单进行编辑（币种、结算比例、账期时间、是否开票），编辑之后状态变为待审核，同时入库单和采购单的状态都变为待结算 

财务管理人员需要对结算单进行审核，审核通过之后变为已审核，然后系统自动发起财务结算，结算单变为已完成；审核不通过则回到编辑中状态 

结算单变为已完成之后，入库单和采购单的状态都变为已完成 

除了走上述流程之外，在入库单完成之后，就是审核通过之后，会依次更新库存，包括仓库库存，调度库存，销售库存 

仓库里面，一旦入库单审核通过之后，会更新自己仓库里的库存，两个维度：商品总库存，每个货位的商品库存 

向上更新调度中心里的库存，也是一样，每个仓库的商品库存，每个货位的商品库存 

继续向上，更新库存中心里的库存，这块是不管仓库的，就是商品的总库存 

2、采购退货流程 

采购退货流程实际上就是一个可逆的流程，跟采购流程是类似的，从采购部发起采购退货；然后WMS系统安排物流进行退货，有出库单；最后是财务收到退款结算 

3、采购管理 

3.1 采购开单的时候，主要是选择如下的数据： 

（1）供应商：从供应商管理模块中获取，主要是获取到供应商列表，选择一个供应商，从谁那里进货

（2）收货仓库：从WMS系统中获取仓库列表，选择一个要收货的仓库

（3）商品信息：从商品中心获取数据，列表，你可以添加要采购的多个商品，每个商品是从商品中心获取的一个下拉列表（可以按照文本搜索）去选择商品，单位是SKU，包含了sku编码、商品名称、规格，同时输入每个商品的采购数量和采购价格（ 默认是采用的创建商品的时候输入的采购价格，但是这里可以修改的）

（4）添加商品的方式：点击一个添加按钮，然后弹出来一个商品列表，里面可以根据分类、品牌、sku编码、商品名称几个选项去筛选商品。商品列表显示的字段包括：sku编码、商品名称、规格、分类、品牌

（5）其他信息包括：预计到货时间、联系人、联系电话、联系邮箱、备注 

3.2 采购单列表页的字段 

（1）采购单基本信息：采购单编号、采购员、供应商、收货仓库

（2）状态：采购状态、入库状态、结算状态

（3）采购商品：SKU种类数量、总数量

（4）金额：总金额、商品金额、物流费用

（5）其他：预计到货时间、备注

（6）操作列：编辑，提交审核 

3.3 编辑采购单 

3.4 对采购单，提交审核 

3.5 对采购单进行审核 

我觉得即使是这样，也很符合真实的开发场景 

你不要以为一个产品需求文档，是一蹴而就的，不是的 

可能那个PM一开始写了一个版本，然后找RD来需求评审，RD在做需求评审的时候，他会去考虑，如何进行技术的设计，或者需求有没有模糊的地方 

有些地方不完善，模糊，会让PM去补充更多的内容 

一般类似电商系统从0到1的一个产品，光是需求评审+需求修改，都至少1个月，反复修改很多个版本 

对我们而言，主要是先理清楚这个电商系统的核心业务流程，后面我们进入技术设计和开发的时候，如果发现有问题，类似工作场景中反馈给PM，再来修改这个产品需求文档，补充原型图，也可以完善更多的细节

#### 07_03_调度中心_调度管理_需求分析

1、调度采购入库 

接收一个采购单，然后创建一个采购入库单 

采购入库单中，需要根据仓库中的每个货位的剩余容量，然后根据商品的采购件数，将每个商品的采购关联分配到对应的货位上去 

2、调度销售出库 

调度中心负责在订单支付之后，对接WMS系统，让WMS系统创建销售出库单，包括其他的出入库单

电商后台将一个订单，购买哪些商品，收货地址，告诉调度中心；然后调度中心负责根据仓库的信息，选择那些商品分别在哪个仓库里进行调度，用什么物流发货，多久可以到 

（1）管理仓库 

维护仓库信息以及物流公司信息 

仓库信息：仓库名称、地址、联系信息、仓库类型（自营中心仓、自营区域仓）、配送区域 

广州中心仓的一级配送区域是广州，二级配送区域是广西、福建、湖南，三级配送区域是其他地方 

每个仓库关联了一些物流公司

（2）选择发货仓 

根据调度规则，按照一定的调度逻辑，来进行商品发货的调度，找到对应的发货仓 

（3）更新库存 

3、调度退货入库

#### 07_04_WMS_仓储管理_需求分析

1、业务知识 

主要是调度中心会负责跟WMS系统进行交互，电商系统其他服务都是跟调度中心进行交互 

实际上来说，电商的系统，WMS系统，仓储管理系统，有几种情况，可以是那种C/S架构的，安装在仓库里面的，第三方提供的专业的仓库管理系统 

我们开发的电商系统可以跟WMS进行通信即可 

但是这里呢，我们采取的是我们自己开发一套WMS系统，WMS系统，我们做成什么架构的 

B/S架构，C/S架构 

B/S架构：每个仓库的管理人员，直接通过一个浏览器，就可以看到自己的仓库里面的一些数据和信息，包括其他仓库的一些数据 

C/S架构：需要在每个仓库里面去安装，一般就是只能看到自己的仓库里的一些数据 

B/S架构：假设认定为，我们这个B2C电商，WMS系统自己开发，B/S架构，可能我们本来就没几个仓库，假设我们搞了几个重要的仓库。石家庄仓库、杭州仓库、广州仓库，负责发货到全国各地。 

然后呢，每个仓库的人，都可以看到所有仓库里面所有的数据 

下面讲解一下比较重要的一些概念 

（1）仓库：管理仓库信息，CRUD 

（2）货位：每个仓库里面，要去管理货位的信息，CRUD，（我们可以想象一下，货位是什么，每个仓库里划分成了很多排货架，一般是分成一排一排的，比如A排；每一排有多个货架，比如A01货架；每个货架有多层，每一层有多个货位，比如A01-1-01） 

（1）入库：采购入库、退货入库、调拨入库，等等 

（2）出库：销售出库、调拨出库，等等 

每次一批商品入库，都会关联一个货位，或者是多个货位 

每次商品要出库的时候，拣货单多会关联一个货位，然后方便仓库工作人员直接到对应的货位去拣货 

2、仓库管理模块 

对仓库信息进行增删改查 

仓库信息的字段：ID、仓库编号、仓库名称、仓库地址、联系人、联系电话、启用状态、备注 

3、货位管理模块 

进入一个货位的列表，上面肯定有一个下拉框，是仓库下拉框，默认选中了一个仓库，显示的是某个仓库的货位列表 

在这个货位列表中进行CRUD 

提供货位的增删改查功能，包括的字段有 

所属的仓库ID、货位编号（A01-1-01）、创建人、创建时间、启用状态、存放总容量（简单一点，就按照件数来算好了，一般来说这块会更加的复杂，可能是按照商品的体积）、剩余容量 

我们可以想象一下，实际上后面讲到在采购商品的时候，你采购了一批商品，然后呢，那批商品，在调度中心里面，调度中心会负责去进行商品入库的调度，就是说，采购了1万件衣服 

调度中心会看一下当前每个货位的剩余容量，每个货位最多可以放1000件衣服 

调度中心会按照一定的规则，将1万件衣服，分配到10个货位中去，每个货位放1000件衣服 

4、商品入库 

（1）到货确认：在商品到了仓库之后，可以进行到货确认

（2）验货打码：检查商品是否合格，同时进行打印出商品条码，贴在商品上

（3）商品上架：按照先进先出的原则，将商品分配和上到对应的货位上去 

上面说的几个步骤是线下实际上在仓库里执行的商品上架的一个流程 

但是在系统中，数据的流转，等到后面讲采购的时候我们一起讲解 

4.1 采购入库单列表 

显示哪些字段呢？跟采购单列表，保持差不多就可以了 

4.2 对采购入库单进行编辑，可以输入良品率、到货时间、到货数量：需要查询一个采购入库单出来，回显，可以编辑 

4.3 对采购入库单提交审核 

4.4 对采购入库单进行审核 

5、商品出库 

一个用户下了一个订单，这个订单的不同的商品会被调度中心，调度到一些仓库里去发货，此时仓库工作人员会收到一个销售出库单，调度中心也标识出了，哪些商品从哪个货位上面去出库，发货 

（1）调度 

锁定库位，跟物流公司进行通信，申请发货物流单号，然后为订单分配一个物流单号 

库位锁定的原则是先进先出，商品入库上架的时候也是先进先出的，这样可以保证商品发货的顺序性 

这里是什么意思，假如说我们2017-01-01进了1万件衣服；2017-02-01又进了1万件衣服；发货的时候，先进先出，优先发2017-01-01进的衣服 

这里锁定的是货位库存，就是每个货位这个商品有多少库存 

（2）打单 

打印发货单、物流单 

你平时网上购物的时候会发现有2个单子 

发货单是放在包裹里面的，告诉你本次发货了哪些东西；物流单是贴在包裹上面的 

发货单，实际上是调度中心直接就给创建好了 

物流单，是调度中心跟第三方物流厂商的系统进行通信，直接申请了一个物流单 

调度中心，发货单（发了哪些商品，商品清单），物流单（哪个物流商，运送到哪儿），商品出库单（调度，从哪个仓库，发送哪些商品，从哪些货位去拣货，物流商是谁） 

（3）捡货 

销售出库单 

女士羊毛衫，从货位A01-2-05，去拿2件

男士袜子，从货位A05-5-09，去拿10件 

就是工作人员推着捡货车去捡货，然后捡货之后会扣减锁定的货位库存 

（4）复核 

对捡货完成的订单进行核对，确保发货单、实物商品、物流单的统一 

（5）包装 

对复核完的商品进行打包和称重，发货单放包裹里面，物流单贴包裹上面 

（6）交接发货 

根据物流单将打包好的商品推送到仓库里面，仓库外面，跟物流公司的交接区，接着物流公司会按照物流单去进行发货 

在线下的一个销售出库的这么一个过程 

我们这次，第一个版本，重点做WMS的仓库管理、货位管理、采购入库、销售出库、退货入库 

6、库存调拨 

我在这里这么说一句，我们这个系统是分版本的，第一个版本，我们就完成核心的功能，每个模块，中心，会员、促销、WMS、支付、订单、商品，我们都留一些业务模块，到后面去做 

为什么呢？ 

因为后面，在进入微服务架构之前，我们要给大家用真实的多模块同时十几个人，并行开发真实的业务需求，迭代业务需求，此时互相之间排期冲突、上线冲突、代码冲突，等等各种问题 

单体应用的话，十几个人，同时给十几个模块加功能，排期不一样，上线时间布一样，测试时间布一样，大量的冲突，导致互相等待，迭代效率低下 

==> 微服务架构，优雅，漂亮，引出来 

还有另外一个，其实是什么呢？我们预留一些功能模块，到后面可能要讲解某个具体的技术，或者是架构的时候，专门来引入那个业务功能，基于那个特殊的业务功能来讲解某个架构 

促销模块，秒杀，促销活动，优惠券 ==> 秒杀，是放到后面去讲的，是为了讲解瞬时超高并发架构去讲解的 

仓内调拨：将部分商品从一些货位里调拨到其他一些货位，让货位负载均衡，方便拣货

仓间调拨：从一个仓库调拨部分商品到另外一个仓库中 

仓库工作人员进行调拨单开单，此时状态是编辑中，编辑后调拨单状态变为待审核。调拨单中需要选择要调拨的商品以及数量 

调拨单的信息包括：调出仓库（下拉框选择），调入仓库（下拉框选择），物流公司，物流单号，备注信息，然后就是添加商品，商品列表包括了sku编码、商品名称、规格、可调拨数量（该仓库的库存）、调拨数量、调出货位、调入货位（下拉框选择） 

调拨单的列表包括了以下的字段：调拨单号、调拨单状态、调出仓库、调入仓库、商品种类、调拨开单量、已出库总量、已入库总量 

仓库管理人员对调拨单进行审核，如果审核通过，则状态变为已审核；如果审核不通过，则状态回到编辑中

审核通过的调拨单，会分配给对应调出仓库的工作人员处理，此时调出仓库的工作人员，可以根据分配过来的调拨单，创建调拨出库单，调拨出库单开单之后，状态是编辑中，保存之后变为待审核，同时此时调拨单的状态变为待出库 

仓库管理人员需要对调拨出库单进行审核，审核之后状态变为已出库，同时调拨单的状态变为已出库，同时仓库开始进行调拨的线下物流操作，往调入仓库运输 

调入仓库接收到运输过来的商品之后，根据调度出库单创建一个调拨入库单，此时状态是编辑中，编辑过后，状态变为待审核，此时调拨单的状态变为待入库 

调入仓库管理人员对调拨入库单进行审核，审核之后，入库单状态变为已完成，调拨单的状态也变为已完成 

同时这个时候开始执行商品入库的操作，包括验货、称重、上架，等等 

7、库存盘点 

如果线下入库出库流程与线上的入库单以及出库单不相符，那么可以进行库存盘点，盘点之后可以自动生成盘盈入库单和盘亏出库单 

仓库工作人员，创建盘点单，此时状态是编辑中，编辑之后，状态变为待审核 

这里选择要盘点的仓库，同时添加仓库里的sku商品进去，商品列表字段包括了：sku编码、商品名称、规格、货位、库存数量 

盘点单列表字段包括了：盘点单号、盘点单状态、仓库、商品种类、备注 

仓库管理人员，对盘点单进行审核，审核通过之后，盘点单状态变为待盘点；审核不通过，盘点单状态变为编辑中 

接着仓库工作人员开始对盘点单进行录入操作，就是要盘点的商品的实际库存数量，录入结束之后，盘点单状态变为已完成 

接着系统自动对盘点单中的系统库存数量以及实际盘点库存数量进行比对，如果库存数量一致，则保持盘点单状态为已完成，会生成盘点盈亏表 

如果库存数量不一致，比如实际库存数量比系统库存数量要少，此时要自动生成盘盈入库单；如果实际库存数量比系统库存数量要多，此时要自动生成盘亏出库单 

此时可以将盘盈入库单发给供货商，让他们补货；也可以根据盘亏出库单，通过线下物流向供应商退货

#### 07_05_财务中心_财务管理_需求分析

1、采购结算单 

1.1 采购结算单列表 

1.2 编辑采购结算单 

1.3 对采购结算单提交审核 

1.4 对采购结算单进行审核 

2、供应商财务结算 

这块的话，主要是对于采购时，与供应商之间的结算提供财务管理功能 

根据供应商的结算周期，周期性的统一对供应商进行结算和打款 

这边的话呢，需要记录下来每次财务结算和打款的一个记录和流水

#### 07_06_库存中心_库存管理_需求分析

1、业务知识 

1.1 库存的几种操作： 

（1）增加：通过采购入库，相当于是增加库存

（2）锁定：下单之后锁定库存

（3）解锁：订单取消之后释放库存

（4）扣减：订单支付成功之后扣减库存，扣减锁定的库存

（5）返还：退货之后返还库存，就是增加库存 

1.2 库存分层 

（1）销售层：销售层的库存，就是在网站上的商品详情页中显示的库存。可销售库存（网站前台显示的库存），锁定库存（下单后锁定库存，支付后扣减库存），已销售库存（支付之后，就是已销售库存），活动库存（做秒杀类促销活动时，预先分配的库存，需要从可销售库存中分配部分给活动库存），预售库存（以后，在促销那块加入拼团，预付参加团购） 

（2）调度层：这块是调度中心负责的，就是对订单调度为发货，与WMS系统对接，按照调度规则，让指定的仓库去发货。分为单仓库存，区域库存（比如华北区域的所有仓库的库存），所有仓库的总库存。调度层是没有所谓的虚拟库存的，都是针对实物库存去调度的。 

（3）仓库层：这是实物库存，可用库存（可以用于发货的库存），锁定库存（发货单推送到WMS系统之后，会锁定库存），已出库库存 

1.3 库存同步 

（1）自上而下：下单支付之后，会扣减销售层的库存；流转到调度层，扣减调度层的库存，同时生成发货通知单；最后是发送到指定仓库的WMS，WMS扣减实物库存，然后执行出库 

（2）自下而上：采购入库，退货入库，调拨入库，都会引起库存变动；从仓库层开始，到调度层，再到销售层，都会逐步增加库存 

2、销售库存管理 

销售库存一般要和调度层的库存保持一致 

（1）提交订单，判断可销售库存是否足够

（2）如果可销售库存数量足够，那么可销售库存加2，锁定库存减2

（3）如果用户确认订单，支付之后，销售总库存减2，现货库存数减2，锁定库存数减2，已销售库存数加2

（4）如果用户取消订单，那么可销售库存加2，锁定库存减2 

3、调度库存管理 

（1）筛选出有商品库存的仓库

（2）将收获地址与这些仓库的一级配送区域匹配（24小时），不行再去二级（2日），三级（2日以上）

（3）对同一级的仓库按照优先级筛选 

4、仓库库存管理 
 5、库存预警

这个服务要负责定时监控每个商品的库存，如果库存过低的时候，要自动生成采购单及时补货

采购开单原型图

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0701.png) 

采购核心流程图

 ![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0702.png)

###  08_商品购物核心流程以及关联多个中心的需求分析

#### WMS_需求分析 

1、业务知识 

主要是调度中心会负责跟WMS系统进行交互，电商系统其他服务都是跟调度中心进行交互 

实际上来说，电商的系统，WMS系统，仓储管理系统，有几种情况，可以是那种C/S架构的，安装在仓库里面的，第三方提供的专业的仓库管理系统 

我们开发的电商系统可以跟WMS进行通信即可 

但是这里呢，我们采取的是我们自己开发一套WMS系统，WMS系统，我们做成什么架构的 

B/S架构，C/S架构 

B/S架构：每个仓库的管理人员，直接通过一个浏览器，就可以看到自己的仓库里面的一些数据和信息，包括其他仓库的一些数据 

C/S架构：需要在每个仓库里面去安装，一般就是只能看到自己的仓库里的一些数据 

B/S架构：假设认定为，我们这个B2C电商，WMS系统自己开发，B/S架构，可能我们本来就没几个仓库，假设我们搞了几个重要的仓库。石家庄仓库、杭州仓库、广州仓库，负责发货到全国各地。 

然后呢，每个仓库的人，都可以看到所有仓库里面所有的数据 

下面讲解一下比较重要的一些概念 

（1）仓库：管理仓库信息，CRUD 

（2）货位：每个仓库里面，要去管理货位的信息，CRUD，（我们可以想象一下，货位是什么，每个仓库里划分成了很多排货架，一般是分成一排一排的，比如A排；每一排有多个货架，比如A01货架；每个货架有多层，每一层有多个货位，比如A01-1-01） 

（1）入库：采购入库、退货入库、调拨入库，等等 

（2）出库：销售出库、调拨出库，等等 

每次一批商品入库，都会关联一个货位，或者是多个货位 

每次商品要出库的时候，拣货单多会关联一个货位，然后方便仓库工作人员直接到对应的货位去拣货 

2、仓库管理模块 

对仓库信息进行增删改查 

仓库信息的字段：ID、仓库编号、仓库名称、仓库地址、联系人、联系电话、启用状态、备注、支持的发货省份（对不同省份有不同的优先级） 

3、货位管理模块 

进入一个货位的列表，上面肯定有一个下拉框，是仓库下拉框，默认选中了一个仓库，显示的是某个仓库的货位列表 

在这个货位列表中进行CRUD 

提供货位的增删改查功能，包括的字段有 

所属的仓库ID、货位编号（A01-1-01）、创建人、创建时间、启用状态、存放总容量（简单一点，就按照件数来算好了，一般来说这块会更加的复杂，可能是按照商品的体积）、剩余容量 

我们可以想象一下，实际上后面讲到在采购商品的时候，你采购了一批商品，然后呢，那批商品，在调度中心里面，调度中心会负责去进行商品入库的调度，就是说，采购了1万件衣服 

调度中心会看一下当前每个货位的剩余容量，每个货位最多可以放1000件衣服 

调度中心会按照一定的规则，将1万件衣服，分配到10个货位中去，每个货位放1000件衣服

4、商品入库 

（1）到货确认：在商品到了仓库之后，可以进行到货确认

（2）验货打码：检查商品是否合格，同时进行打印出商品条码，贴在商品上

（3）商品上架：按照先进先出的原则，将商品分配和上到对应的货位上去 

上面说的几个步骤是线下实际上在仓库里执行的商品上架的一个流程 

但是在系统中，数据的流转，等到后面讲采购的时候我们一起讲解 

4.1 采购入库单列表 

显示哪些字段呢？跟采购单列表，保持差不多就可以了 

4.2 对采购入库单进行编辑，可以输入良品率、到货时间、到货数量：需要查询一个采购入库单出来，回显，可以编辑 

4.3 对采购入库单提交审核 

4.4 对采购入库单进行审核 

5、商品出库 

5.1 销售出库单列表 

5.2 对销售出库单进行编辑 

5.3 走线下的出库流程 

一个用户下了一个订单，这个订单的不同的商品会被调度中心，调度到一些仓库里去发货，此时仓库工作人员会收到一个销售出库单，调度中心也标识出了，哪些商品从哪个货位上面去出库，发货 

（1）调度 

锁定库位，跟物流公司进行通信，申请发货物流单号，然后为订单分配一个物流单号 

库位锁定的原则是先进先出，商品入库上架的时候也是先进先出的，这样可以保证商品发货的顺序性 

这里是什么意思，假如说我们2017-01-01进了1万件衣服；2017-02-01又进了1万件衣服；发货的时候，先进先出，优先发2017-01-01进的衣服 

这里锁定的是货位库存，就是每个货位这个商品有多少库存 

（2）打单 

打印发货单、物流单 

你平时网上购物的时候会发现有2个单子 

发货单是放在包裹里面的，告诉你本次发货了哪些东西；物流单是贴在包裹上面的 

发货单，实际上是调度中心直接就给创建好了 

物流单，是调度中心跟第三方物流厂商的系统进行通信，直接申请了一个物流单 

调度中心，发货单（发了哪些商品，商品清单），物流单（哪个物流商，运送到哪儿），商品出库单（调度，从哪个仓库，发送哪些商品，从哪些货位去拣货，物流商是谁） 

（3）捡货 

销售出库单 

女士羊毛衫，从货位A01-2-05，去拿2件

男士袜子，从货位A05-5-09，去拿10件 

就是工作人员推着捡货车去捡货，然后捡货之后会扣减锁定的货位库存 

（4）复核 

对捡货完成的订单进行核对，确保发货单、实物商品、物流单的统一 

（5）包装 

对复核完的商品进行打包和称重，发货单放包裹里面，物流单贴包裹上面 

（6）交接发货 

根据物流单将打包好的商品推送到仓库里面，仓库外面，跟物流公司的交接区，接着物流公司会按照物流单去进行发货 

在线下的一个销售出库的这么一个过程 

我们这次，第一个版本，重点做WMS的仓库管理、货位管理、采购入库、销售出库、退货入库 

5.4 对销售出库单进行审核 

审核通过后，通知财务中心给物流商打款 

6、库存调拨 

我在这里这么说一句，我们这个系统是分版本的，第一个版本，我们就完成核心的功能，每个模块，中心，会员、促销、WMS、支付、订单、商品，我们都留一些业务模块，到后面去做 

为什么呢？ 

因为后面，在进入微服务架构之前，我们要给大家用真实的多模块同时十几个人，并行开发真实的业务需求，迭代业务需求，此时互相之间排期冲突、上线冲突、代码冲突，等等各种问题 

单体应用的话，十几个人，同时给十几个模块加功能，排期不一样，上线时间布一样，测试时间布一样，大量的冲突，导致互相等待，迭代效率低下 

==> 微服务架构，优雅，漂亮，引出来 

还有另外一个，其实是什么呢？我们预留一些功能模块，到后面可能要讲解某个具体的技术，或者是架构的时候，专门来引入那个业务功能，基于那个特殊的业务功能来讲解某个架构 

促销模块，秒杀，促销活动，优惠券 ==> 秒杀，是放到后面去讲的，是为了讲解瞬时超高并发架构去讲解的 

仓内调拨：将部分商品从一些货位里调拨到其他一些货位，让货位负载均衡，方便拣货

仓间调拨：从一个仓库调拨部分商品到另外一个仓库中 

仓库工作人员进行调拨单开单，此时状态是编辑中，编辑后调拨单状态变为待审核。调拨单中需要选择要调拨的商品以及数量 

调拨单的信息包括：调出仓库（下拉框选择），调入仓库（下拉框选择），物流公司，物流单号，备注信息，然后就是添加商品，商品列表包括了sku编码、商品名称、规格、可调拨数量（该仓库的库存）、调拨数量、调出货位、调入货位（下拉框选择） 

调拨单的列表包括了以下的字段：调拨单号、调拨单状态、调出仓库、调入仓库、商品种类、调拨开单量、已出库总量、已入库总量 

仓库管理人员对调拨单进行审核，如果审核通过，则状态变为已审核；如果审核不通过，则状态回到编辑中 

审核通过的调拨单，会分配给对应调出仓库的工作人员处理，此时调出仓库的工作人员，可以根据分配过来的调拨单，创建调拨出库单，调拨出库单开单之后，状态是编辑中，保存之后变为待审核，同时此时调拨单的状态变为待出库 

仓库管理人员需要对调拨出库单进行审核，审核之后状态变为已出库，同时调拨单的状态变为已出库，同时仓库开始进行调拨的线下物流操作，往调入仓库运输 

调入仓库接收到运输过来的商品之后，根据调度出库单创建一个调拨入库单，此时状态是编辑中，编辑过后，状态变为待审核，此时调拨单的状态变为待入库 

调入仓库管理人员对调拨入库单进行审核，审核之后，入库单状态变为已完成，调拨单的状态也变为已完成 

同时这个时候开始执行商品入库的操作，包括验货、称重、上架，等等 

7、库存盘点 

如果线下入库出库流程与线上的入库单以及出库单不相符，那么可以进行库存盘点，盘点之后可以自动生成盘盈入库单和盘亏出库单 

仓库工作人员，创建盘点单，此时状态是编辑中，编辑之后，状态变为待审核 

这里选择要盘点的仓库，同时添加仓库里的sku商品进去，商品列表字段包括了：sku编码、商品名称、规格、货位、库存数量 

盘点单列表字段包括了：盘点单号、盘点单状态、仓库、商品种类、备注 

仓库管理人员，对盘点单进行审核，审核通过之后，盘点单状态变为待盘点；审核不通过，盘点单状态变为编辑中 

接着仓库工作人员开始对盘点单进行录入操作，就是要盘点的商品的实际库存数量，录入结束之后，盘点单状态变为已完成 

接着系统自动对盘点单中的系统库存数量以及实际盘点库存数量进行比对，如果库存数量一致，则保持盘点单状态为已完成，会生成盘点盈亏表 

如果库存数量不一致，比如实际库存数量比系统库存数量要少，此时要自动生成盘盈入库单；如果实际库存数量比系统库存数量要多，此时要自动生成盘亏出库单 

此时可以将盘盈入库单发给供货商，让他们补货；也可以根据盘亏出库单，通过线下物流向供应商退货

#### 财务中心_需求分析

1、采购结算单

1.1 采购结算单列表

1.2 编辑采购结算单

1.3 对采购结算单提交审核

1.4 对采购结算单进行审核

2、供应商财务结算

这块的话，主要是对于采购时，与供应商之间的结算提供财务管理功能

根据供应商的结算周期，周期性的统一对供应商进行结算和打款

这边的话呢，需要记录下来每次财务结算和打款的一个记录和流水

3、物流公司财务结算

每次给物流公司打款，都会记录一条交易流水

#### 调度中心_需求分析

1、调度采购入库 

接收一个采购单，然后创建一个采购入库单 

采购入库单中，需要根据仓库中的每个货位的剩余容量，然后根据商品的采购件数，将每个商品的采购关联分配到对应的货位上去 

2、调度销售出库 

调度中心负责在订单支付之后，对接WMS系统，让WMS系统创建销售出库单，包括其他的出入库单 

电商后台将一个订单，购买哪些商品，收货地址，告诉调度中心；然后调度中心负责根据仓库的信息，选择那些商品分别在哪个仓库里进行调度，用什么物流发货，多久可以到 

有几个核心的信息：每个商品购买了几件，每个商品自己的毛重是多少，一个商品的总毛重是多少，收货地址是哪里 

2.1 管理仓库基础数据 

维护仓库信息以及物流公司信息 

仓库信息：仓库名称、地址、联系信息、仓库类型（自营中心仓、自营区域仓）、配送区域 

广州仓库的一级配送区域是广州，二级配送区域是广西、福建、湖南，三级配送区域是其他地方 

每个仓库关联了一些物流公司 

2.2 选择发货仓 

根据调度规则，按照一定的调度逻辑，来进行商品发货的调度，找到对应的发货仓 

设计一个较为简化的发货调度的方法 

（1）不同的仓库，对不同的区域，是有发货的分级的，越近的地方，分级是越近的。有些太偏远的地方，是不支持发货的。同一个省份，可能多个仓库都可以发货，但是一定是有一个仓库是优先级最高的，比如说湖南发货，杭州仓库对湖南就是二级区域；但是广州仓库，可能对湖南就是一级区域 

（2）根据收货地址所在省份，优先找一下，自己是一级区域的仓库，是否有库存，优先从这个仓库发货；如果一级区域不行，可以找自己是二级区域的仓库，也可以发货；如果二级区域不行，直接不支持对这个地区发货这个商品了 

（3）调度这个仓库中用来发货的货位，首先按照商品上架的时间顺序排序，按照先进先出的原则，有这个商品的货位，按照时间先进先出排序，最早上架的商品排在最前面，先发货 

（4）比如找到一个货位，上面有5件商品，如果你要购买一件这个商品，那么就从这个货位去发货就可以了；如果你要购买10件这个商品，会将你的商品，拆分成两个发货条目，先从一个货位取5个商品，再从下一个货位取5个商品 

（5）最终将订单中的每个商品，都直接绑定到一个仓库的一个货位上去 

2.3 创建销售出库单 

销售出库单，包含了订单中的几乎所有的数据，然后还包含了自己对仓库和货位的一个调度，一个商品购买10件，可能会被拆分为两个发货条目，但是每个发货条目，都会将商品关联到一个货位上去 

然后同步到WMS系统 

2.4 创建发货单 

2.5 创建物流单 

跟第三方物流商进行通信，获取一个物流单号 

3、调度退货入库

#### 订单中心_需求分析

1、业务知识

（1）订单有哪些东西 

订单信息：记录订单信息

订单流程：包含订单生成到完成的全流程

订单状态：订单各个状态的流转

订单推送：订单状态变化时，需要推送订单告知关联方

订单管理：订单查询、与WMS交互 

（2）订单的状态 

几种状态：待付款、待发货、待收货、交易成功、已取消、售后中 

2、订单流程 

2.1 订单确认页（通过购物车进入） 

（1）选择一个收获地址

（2）选择一种支付方式：微信，支付宝

（3）送货清单：商品列表（商品名称、缩略图、使用的促销活动、商品总价、毛重、购买数量、库存数量、配送区域是否有货）

（4）下面有一个总计，几件商品、总金额、运费、应付总额、收货地址/收货人/手机号码

（5）点击提交订单 

2.2 订单生成 

此时，你要购买的那些商品的数据，他们对应的那个订单就已经生成了，此时会有一个订单号出来，告诉你这个订单要支付多少钱，24小时内完成支付，否则系统自动取消订单 

下面给出来你选择的支付方式的支付页面，支付宝/微信，扫码支付 

2.3 订单列表 

下单时间、订单号 

订单中包含的商品列表：缩略图、商品名称、购买数量、收货人姓名、总金额、应付金额、订单状态（未付款的时候，叫做等待付款）、跟踪物流、查看订单详情、操作栏（取消订单、付款） 

2.4 订单详情 

订单号、订单状态（等待付款）

订单的操作日志记录，你对订单做的所有的操作，都会记录订单操作日志流水

收货人信息、配送信息、付款信息、发票信息

商品列表：缩略图、商品名称、销售属性、商品编号、商品售价、购买数量

订单总金额、运费、应付总金额 

2.5 取消订单 

（1）手动取消订单：点击按钮后，选择一个取消原因，订单状态变为已取消

（2）自动取消订单：系统自动追踪每个订单，如果是超过24小时没支付的订单，系统直接自动取消，状态为已取消 

2.6 对订单进行支付 

走支付中心，订单状态变为待发货，如果订单支付之后，会给订单关联支付信息 

将订单信息推送到调度中心去 

前面是通过直接在京东上选购商品来看的，后面的流程，就属于系统后台的工作了，我们在京东前台都是看不到的了，画图了 

2.7 对物流进度进行查看 

2.8 确认收货 

（1）手动确认收货

（2）自动确认收货：第三方物流商的状态是已经签收了，然后超过7天没点击确认收货，系统自动确认收货 

（1）订单流程 

生成订单，此时订单处于待付款状态，如果此时用户取消订单，那么关闭交易并且删除订单 

用户付款，此时订单处于待发货状态，如果此时用户申请退款，那么后台冻结订单，终止发货流程，然后系统自动退款

网站已发货，此时订单处于待收货状态， 此时不允许退款或者退货 

用户收到商品之后，可以点击确认收货，但是如果一直没有确认收货，那么有自动确认收货的功能，此时订单处于已完成状态 

此时如果用户申请退货，那么需要走后台工单处理流程，生成退货单，客服审核可以退货，用户寄送商品回来同时上传快递单号，仓库收到并且退货入库，客服确认退款，通过财务完成退款 

（2）订单包含的信息 

用户信息：用户账号、用户等级

订单基础信息：订单编号、订单状态

收货信息：收货地址、收货人姓名、联系电话、邮编

商品信息：SKU、规格、商品数量、价格、商品图片、商家

优惠信息：优惠券、促销活动、虚拟币抵扣金额

支付信息：支付方式、支付单号、商品总金额、实付金额、运费、优惠券优惠金额、总优惠金额

物流信息：物流公司、物流单号、物流状态

其他信息：发票信息 

（3）订单的价格计算 

订单实付金额=商品金额（SKU金额合计）+运费-总优惠金额 

总优惠金额=促销活动优惠金额+优惠券优惠金额 

3、订单管理 

订单查询：订单搜索，条件筛选（订单时间，订单状态，订单来源，订单字段范围） 

订单新建：主要是针对的线下大宗订单，不是用户自己下的，可能是电商网站的大宗商品交易部门的员工为大客户下的 

包括了选择用户、设置收货地址、选择商品（分类、品牌、SKU、名称）、价格和数量设置、支付（客服支付，在这之前用户可能已经将货款打了过来了） 

包括了补发订单（输入原订单号，选择商品），换货订单（输入原订单号，更换商品） 

4、订单售后 

用户退货：用户点击退货申请，客服进行退货审批，系统生成退货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服提交退款申请给财务，财务确认退款 

用户换货：用户点击换货申请，客服进行换货审批，系统生成换货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服手工生成换货订单 

订单审核：用户黑名单过滤（系统），异常订单预警（系统），订单财务风险审核（财务，针对线下大宗订单） 

订单转发货单：主要是针对之前说的线下大宗订单，手工创建订单之后，需要通过这个功能，将订单转为发货单，包括发货单创建/编辑（收货人信息、商品信息、发票信息），发货单同步到WMS系统，WMS同步发货单状态到系统（打印->拣货->配货->包装->称重->出库->在途->签收->缺货） 

订单取消：如果发货单未拣货，可以提交取消申请，进行发货单拦截（同步通知WMS系统），进行取消审批，退款 

订单时常监控：订单状态节点异常时长监控设置，异常订单预警

####  购物车_需求分析

1、加入购物车 

在商品详情页，点击按钮，将一个商品加入购物车中 

2、查看购物车 

显示了加入购物车的商品列表 

购物车中的每个商品，包含的数据：商品缩略图、商品名称、销售属性、商品价格、购买数量（可以调节）、商品总价（购买数量 * 商品价格）、商品毛重、操作栏（删除）、商品库存、配送区域内仓库是否有货、促销活动列表（到促销那块儿的时候再说） 

商品列表的右上方，计算出了这些商品的运费 

商品列表的右下方，计算出了商品的总价，商品价格 + 商品的运费 

购物车关联的系统包括了3个：商品中心、库存中心、促销中心、物流中心 

每次购物车展示的时候，都会从商品系统里面查询数据，从库存系统里面查询库存，从促销系统里面查询促销信息 

3.1 备注：实现方式 

比较好的一种方式，是将购物车持久化，也就是说，将用户和商品的购物车关联关系，落地存储到数据库中去，那么下次用户再次登录的时候，无论隔了多久，都可以将购物车还原回来 

3、购物车结算 -> 下订单

#### 库存中心_需求分析

1、业务知识 

1.1 库存的几种操作： 

（1）增加：通过采购入库，相当于是增加库存

（2）锁定：下单之后锁定库存

（3）解锁：订单取消之后释放库存

（4）扣减：订单支付成功之后扣减库存，扣减锁定的库存

（5）返还：退货之后返还库存，就是增加库存 

1.2 库存分层 

（1）销售层：销售层的库存，就是在网站上的商品详情页中显示的库存。可销售库存（网站前台显示的库存），锁定库存（下单后锁定库存，支付后扣减库存），已销售库存（支付之后，就是已销售库存），活动库存（做秒杀类促销活动时，预先分配的库存，需要从可销售库存中分配部分给活动库存），预售库存（以后，在促销那块加入拼团，预付参加团购）

（2）调度层：这块是调度中心负责的，就是对订单调度为发货，与WMS系统对接，按照调度规则，让指定的仓库去发货。分为单仓库存，区域库存（比如华北区域的所有仓库的库存），所有仓库的总库存。调度层是没有所谓的虚拟库存的，都是针对实物库存去调度的。 

举个例子，就是比如说有3个仓库，石家庄仓库，杭州仓库，广州仓库 

每个仓库有限定可以发货的区域：石家庄仓库的发货区域，包含了河北省，北京市，东北三省，西北；杭州仓库，支持发货的区域，包括了江浙两省，上海市，湖南，湖北；广州仓库，支持发深圳，广东省，江西省，海南省 

用户在那个网站上面选择自己的区域，一般是支持三级的，到一个区域，省/市/区。我们这里简化，就是可以选择一个省份 

用户选择了一个省份，此时需要ajax发送异步请求，到后台，直接去走调度中心，去查一下支持这个省份的仓库，这个商品，还有没有库存了 

（3）仓库层：这是实物库存，可用库存（可以用于发货的库存），锁定库存（发货单推送到WMS系统之后，会锁定库存），已出库库存 

1.3 库存同步 

（1）自上而下：下单支付之后，会扣减销售层的库存；流转到调度层，扣减调度层的库存，同时生成发货通知单；最后是发送到指定仓库的WMS，WMS扣减实物库存，然后执行出库 

（2）自下而上：采购入库，退货入库，调拨入库，都会引起库存变动；从仓库层开始，到调度层，再到销售层，都会逐步增加库存 

2、销售库存管理 

销售库存一般要和调度层的库存保持一致 

（1）提交订单，判断可销售库存是否足够，库存中心 -> 调度中心，再看一下，那个配送区域内的那个仓库，这个商品是否有库存，库存数量是否支持购买 

（2）如果可销售库存数量足够 

那么库存中心，销售库存减1，锁定库存加1 

调度中心，商品总库存减1，通过调度算法选择一个仓库来支持这个商品，找到是哪个仓库会发货，给那个仓库中的商品库存减1，给仓库中调度出来的一个货位的库存减1；对应的商品锁定库存、仓库锁定库存、货位锁定库存，都加1 

仓库，仓库总库存减1，货位库存减1；仓库锁定库存加1，仓库货位库存加1 

（3）如果用户取消订单 

库存中心：销售库存加1，锁定库存减1

调度中心：3个销售库存加1，3个锁定库存减1

仓库：2个销售库存加1，2个锁定库存减1 

（3）如果用户确认支付订单 

库存中心：锁定库存减1，已销售库存加1

调度中心：3个锁定库存减1，3个已销售库存加1

仓库：2个锁定库存减1，2个已销售库存加1 

3、调度库存管理 

（1）筛选出有商品库存的仓库

（2）将收获地址与这些仓库的一级配送区域匹配（24小时），不行再去二级（2日），三级（2日以上）

（3）对同一级的仓库按照优先级筛选 

4、仓库库存管理 

5、库存预警

这个服务要负责定时监控每个商品的库存，如果库存过低的时候，要自动生成采购单及时补货

#### 前端页面_需求分析

1、业务知识 

首页

商品筛选列表页

商品搜索结果页

商品详情页 

搜索，直接按照商品标题进行like搜索，然后按照销量、评论数量、好评度、上架日期，来排序 

搜索之后进行的列表页，或者是点击分类进入的列表页，都可以进行筛选 

2、电商首页 

我们照着京东来分析一下，电商的首页包含些什么东西，我们不可能做一个京东电商首页出来 

我们抽取一些常见的通用的一些东西，来设计我们的这个首页，要展示的数据 

（1）左侧的品类列表

（2）上册的搜索框

（3）中间的滚动活动

（4）下面是一些热门品类的最热门的一些商品 

3、商品搜索 

要买个东西，有很明确的诉求，比如说你就是要买iphone 7 plus 

此时你是不会走左侧的分类导航栏的，会直接在上面的搜索框中输入iphone 7 plus，你要购买的商品的名称 

搜索结果会进入商品列表页面 

4、品类导航 

我现在想买一个手机，但是我不知道要买什么型号，我只是知道我要买一个手机而已 

此时你是不会在搜索栏中输入的，一般就会在左侧的品类导航栏中，去点击一个品类 

然后会进入那个品类的商品列表页 

5、滚动图片 

我们简化为，我们的网站就是会显示top 10热门的商品，来回滚动，点击一下直接进入那个商品的详情页 

6、热门品类的热门商品 

第一次进网站，你是可能没什么特别的购物的目的，你没有想好要买什么，更没想好具体要买什么商品，进了网站就是来随便逛逛的 

此时会浏览首页，往下拉，看每个热门品类有哪些热门商品 

就可以直接点击商品，进入商品详情页 

7、商品列表页 

可以根据各个商品的导航属性的属性值，去进行筛选，支持分页 

8、商品详情页 

点击一个商品，就会进入商品详情页 

（1）商品名称

（2）商品副名称

（3）商品售价

（4）配送至

（5）销售属性

（6）库存数量

（7）规格（非关键属性，属性组）

（8）包装清单

（9）售后保障

（10）商品图片

（11）商品描述

#### 物流中心_需求分析

这块，主要是电商网站走第三方物流发货出去，这个过程，该如何进行管理，主要是与第三方物流系统的对接，包装物流状态的查询 

在用户下单的时候，需要根据选择的运费模板进行运费的计算，然后收取运费。接着在仓库里出货的时候，需要选择物流配送公司，推送订单给物流公司，然后还要跟踪物流公司的运输状态，最后还要跟物流公司进行结算和对账 

1、运费模板 

这个就是要提供不同的运费模板，比如说固定运费10元、满X元包邮、自定义规则 

可以创建运费模板，包括运费模板名称、计费规则（固定运费/满X元包邮/自定义规则） 

如果是固定运费和满X元包邮，那么就比较简单了，包括在计算运费的时候，就判断订单最后实付金额就可以了 

但是很多常用的是自定义规则，就是说定好一个距离 

比如发送到附近几个省，在多少重量以内，是多少钱，一个固定价，接着每增加多少重量会增加多少钱；对再偏远的省份，又是一套计算规则，多少重量以内是多少钱，加多少重量会加多少钱 

运费的计算公式=首重费用+（实际邮寄重量-首重）/续重*续重费用。以江浙沪皖同省跨市件为例，首重1kg，首重费用为10元，在50kg内，每增加1kg，则需要增加2元的运费。那么快递3.5kg的物品的运费=10+（3.5-1）/1*2=16（运费需要向上取整，3.5Kg按4kg计算) 

在物流中心里面，需要对运维模板进行管理，在添加商品的时候，对不同的商品要绑定不同的运维模板

2、运费计算

根据运费模板，计算出来对应的运费 

如果是自定义规则这种比较复杂的形式，那么在用户选择了商品数量和目的地之后，就可以参照目的地的计算规则，然后算出来重量，根据重量就可以算出来对应的运费 

3、物流追踪 

在物流发货之后，会自动将订单锁定一个物流单号，然后之后会调用物流公司的接口，进行物流状态的查询

#### 支付中心_需求分析

初期就做的比较简单了，支付模块每次支付的时候，都是调用第三方支付平台，然后更新虚拟资金账户，同时更新订单状态，就可以了 

（1）调用第三方支付平台接口 

（2）记录支付信息 

交易流水号（第三方平台生成），创建时间，完成时间，订单号，费用信息（订单总金额、优惠金额、应付金额） 

交易渠道信息：交易渠道（支付宝、微信），渠道账户，执行支付的时间，渠道返回的支付订单号，渠道返回的状态码（错误码和错误信息） 

支付用户信息：用户类型、用户账号（有人用支付宝来支付，我们可以拿到他的支付宝账号在给我支付） 

支付状态：支付成功，支付失败，已退款 

（3）支付对账 

每隔一段时间，比如一天，一天的凌晨，向第三方渠道系统请求下载日账单，或者是月账单，然后跟自己记录的交易明细进行比对，看账目是否一致 

日对账，周对账，月对账

#### 注册与登录_需求分析

1、总结 

跟大家说一下，我们之前已经讲完了：商品中心、WMS、采购流程（采购中心、调度中心、WMS、财务中心、库存中心） 

到这一步为止，我们已经可以实现什么效果呢？ 

1、我们可以在商品中心里面创建一些商品出来

2、我们可以在WMS中维护仓库和货位的数据

3、我们可以通过采购中心作为入口，发起商品的采购，实际的货物会进入仓库，商品的库存会在销售层（库存中心）->调度层（调度中心）->仓库层（WMS）会全部更新

4、此时商品是有库存的

5、然后我们可以走之前商品中心说过的，对商品发起审核，审核通过之后可以进行上架 

后台一系列的准备商品的过程，就结束了 

我们就可以作为一个普通的用户，从网站首页进来，开始执行一系列的行为，最终付钱购买网站中售卖的商品 

2、会员注册 

（1）用户名

（2）密码

（3）重复输入一次密码

（4）手机号

（5）验证码

（6）手机验证码 

用户注册的流程是什么呢？填好前面的信息，然后点击按钮获取手机验证码，再输入 

点击立即注册按钮，就可以完成注册，你的一个账号就有了 

3、会员登录 

3.1 支持微信/QQ的直接登录，第三方账号登录 

3.2 用自己的账号去登录 

（1）输入手机号码

（2）输入密码即可 

不同的网站，概念不同 

有些网站是说，你注册进来是用户，还不是会员 

有些网站的理念是说，注册即会员，给你开通了一个会员你的账号，后面你可以围绕着你的会员， 去做各种事情，你的会员成长值的积累，会员积分，都是跟着你的会员账号关联的 

所以我这里采取的是第二个理念，注册即会员

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0801.png)  

### 09_商品退货核心流程以及关联多个中心的需求分析

#### WMS_需求分析

1、业务知识 

主要是调度中心会负责跟WMS系统进行交互，电商系统其他服务都是跟调度中心进行交互 

实际上来说，电商的系统，WMS系统，仓储管理系统，有几种情况，可以是那种C/S架构的，安装在仓库里面的，第三方提供的专业的仓库管理系统 

我们开发的电商系统可以跟WMS进行通信即可 

但是这里呢，我们采取的是我们自己开发一套WMS系统，WMS系统，我们做成什么架构的 

B/S架构，C/S架构 

B/S架构：每个仓库的管理人员，直接通过一个浏览器，就可以看到自己的仓库里面的一些数据和信息，包括其他仓库的一些数据 

C/S架构：需要在每个仓库里面去安装，一般就是只能看到自己的仓库里的一些数据

B/S架构：假设认定为，我们这个B2C电商，WMS系统自己开发，B/S架构，可能我们本来就没几个仓库，假设我们搞了几个重要的仓库。石家庄仓库、杭州仓库、广州仓库，负责发货到全国各地。 

然后呢，每个仓库的人，都可以看到所有仓库里面所有的数据 

下面讲解一下比较重要的一些概念 

（1）仓库：管理仓库信息，CRUD 

（2）货位：每个仓库里面，要去管理货位的信息，CRUD，（我们可以想象一下，货位是什么，每个仓库里划分成了很多排货架，一般是分成一排一排的，比如A排；每一排有多个货架，比如A01货架；每个货架有多层，每一层有多个货位，比如A01-1-01） 

（1）入库：采购入库、退货入库、调拨入库，等等 

（2）出库：销售出库、调拨出库，等等 

每次一批商品入库，都会关联一个货位，或者是多个货位 

每次商品要出库的时候，拣货单多会关联一个货位，然后方便仓库工作人员直接到对应的货位去拣货 

2、仓库管理模块 

对仓库信息进行增删改查 

仓库信息的字段：ID、仓库编号、仓库名称、仓库地址、联系人、联系电话、启用状态、备注、支持的发货省份（对不同省份有不同的优先级） 

3、货位管理模块 

进入一个货位的列表，上面肯定有一个下拉框，是仓库下拉框，默认选中了一个仓库，显示的是某个仓库的货位列表 

在这个货位列表中进行CRUD 

提供货位的增删改查功能，包括的字段有 

所属的仓库ID、货位编号（A01-1-01）、创建人、创建时间、启用状态、存放总容量（简单一点，就按照件数来算好了，一般来说这块会更加的复杂，可能是按照商品的体积）、剩余容量 

我们可以想象一下，实际上后面讲到在采购商品的时候，你采购了一批商品，然后呢，那批商品，在调度中心里面，调度中心会负责去进行商品入库的调度，就是说，采购了1万件衣服 

调度中心会看一下当前每个货位的剩余容量，每个货位最多可以放1000件衣服 

调度中心会按照一定的规则，将1万件衣服，分配到10个货位中去，每个货位放1000件衣服 

4、商品入库 

（1）到货确认：在商品到了仓库之后，可以进行到货确认

（2）验货打码：检查商品是否合格，同时进行打印出商品条码，贴在商品上

（3）商品上架：按照先进先出的原则，将商品分配和上到对应的货位上去 

上面说的几个步骤是线下实际上在仓库里执行的商品上架的一个流程 

但是在系统中，数据的流转，等到后面讲采购的时候我们一起讲解 

4.1 采购入库单列表 

显示哪些字段呢？跟采购单列表，保持差不多就可以了 

4.2 对采购入库单进行编辑，可以输入良品率、到货时间、到货数量：需要查询一个采购入库单出来，回显，可以编辑 

4.3 对采购入库单提交审核 

4.4 对采购入库单进行审核 

5、商品出库 

5.1 销售出库单列表 

5.2 对销售出库单进行编辑 

5.3 走线下的出库流程 

一个用户下了一个订单，这个订单的不同的商品会被调度中心，调度到一些仓库里去发货，此时仓库工作人员会收到一个销售出库单，调度中心也标识出了，哪些商品从哪个货位上面去出库，发货 

（1）调度

锁定库位，跟物流公司进行通信，申请发货物流单号，然后为订单分配一个物流单号 

库位锁定的原则是先进先出，商品入库上架的时候也是先进先出的，这样可以保证商品发货的顺序性 

这里是什么意思，假如说我们2017-01-01进了1万件衣服；2017-02-01又进了1万件衣服；发货的时候，先进先出，优先发2017-01-01进的衣服 

这里锁定的是货位库存，就是每个货位这个商品有多少库存 

（2）打单 

打印发货单、物流单 

你平时网上购物的时候会发现有2个单子 

发货单是放在包裹里面的，告诉你本次发货了哪些东西；物流单是贴在包裹上面的 

发货单，实际上是调度中心直接就给创建好了 

物流单，是调度中心跟第三方物流厂商的系统进行通信，直接申请了一个物流单 

调度中心，发货单（发了哪些商品，商品清单），物流单（哪个物流商，运送到哪儿），商品出库单（调度，从哪个仓库，发送哪些商品，从哪些货位去拣货，物流商是谁） 

（3）捡货 

销售出库单 

女士羊毛衫，从货位A01-2-05，去拿2件

男士袜子，从货位A05-5-09，去拿10件 

就是工作人员推着捡货车去捡货，然后捡货之后会扣减锁定的货位库存 

（4）复核 

对捡货完成的订单进行核对，确保发货单、实物商品、物流单的统一 

（5）包装 

对复核完的商品进行打包和称重，发货单放包裹里面，物流单贴包裹上面 

（6）交接发货 

根据物流单将打包好的商品推送到仓库里面，仓库外面，跟物流公司的交接区，接着物流公司会按照物流单去进行发货 

在线下的一个销售出库的这么一个过程 

我们这次，第一个版本，重点做WMS的仓库管理、货位管理、采购入库、销售出库、退货入库 

5.4 对销售出库单进行审核 

审核通过后，通知财务中心给物流商打款 

6、退货入库 

6.1 退货入库单列表 

6.2 收到退货入库的商品 

6.3 编辑退货入库单 

输入退货到货日期、退货商品质量检查结果、退货商品数量，保存 

6.4 执行线下的退货入库的上架操作 

跟调度中心的调度，将商品放到对应的货位上去 

6.5 审核退货入库单 

以后做的业务功能 

6、库存调拨 

我在这里这么说一句，我们这个系统是分版本的，第一个版本，我们就完成核心的功能，每个模块，中心，会员、促销、WMS、支付、订单、商品，我们都留一些业务模块，到后面去做 

为什么呢？ 

因为后面，在进入微服务架构之前，我们要给大家用真实的多模块同时十几个人，并行开发真实的业务需求，迭代业务需求，此时互相之间排期冲突、上线冲突、代码冲突，等等各种问题 

单体应用的话，十几个人，同时给十几个模块加功能，排期不一样，上线时间布一样，测试时间布一样，大量的冲突，导致互相等待，迭代效率低下 

==> 微服务架构，优雅，漂亮，引出来 

还有另外一个，其实是什么呢？我们预留一些功能模块，到后面可能要讲解某个具体的技术，或者是架构的时候，专门来引入那个业务功能，基于那个特殊的业务功能来讲解某个架构 

促销模块，秒杀，促销活动，优惠券 ==> 秒杀，是放到后面去讲的，是为了讲解瞬时超高并发架构去讲解的 

仓内调拨：将部分商品从一些货位里调拨到其他一些货位，让货位负载均衡，方便拣货

仓间调拨：从一个仓库调拨部分商品到另外一个仓库中 

仓库工作人员进行调拨单开单，此时状态是编辑中，编辑后调拨单状态变为待审核。调拨单中需要选择要调拨的商品以及数量 

调拨单的信息包括：调出仓库（下拉框选择），调入仓库（下拉框选择），物流公司，物流单号，备注信息，然后就是添加商品，商品列表包括了sku编码、商品名称、规格、可调拨数量（该仓库的库存）、调拨数量、调出货位、调入货位（下拉框选择） 

调拨单的列表包括了以下的字段：调拨单号、调拨单状态、调出仓库、调入仓库、商品种类、调拨开单量、已出库总量、已入库总量 

仓库管理人员对调拨单进行审核，如果审核通过，则状态变为已审核；如果审核不通过，则状态回到编辑中 

审核通过的调拨单，会分配给对应调出仓库的工作人员处理，此时调出仓库的工作人员，可以根据分配过来的调拨单，创建调拨出库单，调拨出库单开单之后，状态是编辑中，保存之后变为待审核，同时此时调拨单的状态变为待出库 

仓库管理人员需要对调拨出库单进行审核，审核之后状态变为已出库，同时调拨单的状态变为已出库，同时仓库开始进行调拨的线下物流操作，往调入仓库运输 

调入仓库接收到运输过来的商品之后，根据调度出库单创建一个调拨入库单，此时状态是编辑中，编辑过后，状态变为待审核，此时调拨单的状态变为待入库 

调入仓库管理人员对调拨入库单进行审核，审核之后，入库单状态变为已完成，调拨单的状态也变为已完成 

同时这个时候开始执行商品入库的操作，包括验货、称重、上架，等等 

7、库存盘点 

如果线下入库出库流程与线上的入库单以及出库单不相符，那么可以进行库存盘点，盘点之后可以自动生成盘盈入库单和盘亏出库单 

仓库工作人员，创建盘点单，此时状态是编辑中，编辑之后，状态变为待审核 

这里选择要盘点的仓库，同时添加仓库里的sku商品进去，商品列表字段包括了：sku编码、商品名称、规格、货位、库存数量 

盘点单列表字段包括了：盘点单号、盘点单状态、仓库、商品种类、备注 

仓库管理人员，对盘点单进行审核，审核通过之后，盘点单状态变为待盘点；审核不通过，盘点单状态变为编辑中 

接着仓库工作人员开始对盘点单进行录入操作，就是要盘点的商品的实际库存数量，录入结束之后，盘点单状态变为已完成 

接着系统自动对盘点单中的系统库存数量以及实际盘点库存数量进行比对，如果库存数量一致，则保持盘点单状态为已完成，会生成盘点盈亏表 

如果库存数量不一致，比如实际库存数量比系统库存数量要少，此时要自动生成盘盈入库单；如果实际库存数量比系统库存数量要多，此时要自动生成盘亏出库单 

此时可以将盘盈入库单发给供货商，让他们补货；也可以根据盘亏出库单，通过线下物流向供应商退货

#### 财务中心_需求分析

1、采购结算单 

1.1 采购结算单列表 

1.2 编辑采购结算单 

1.3 对采购结算单提交审核 

1.4 对采购结算单进行审核 

2、供应商财务结算 

这块的话，主要是对于采购时，与供应商之间的结算提供财务管理功能 

根据供应商的结算周期，周期性的统一对供应商进行结算和打款 

这边的话呢，需要记录下来每次财务结算和打款的一个记录和流水 

3、物流公司财务结算 

每次给物流公司打款，都会记录一条交易流水 

4、退货打款

#### 调度中心_需求分析

1、调度采购入库

接收一个采购单，然后创建一个采购入库单 

采购入库单中，需要根据仓库中的每个货位的剩余容量，然后根据商品的采购件数，将每个商品的采购关联分配到对应的货位上去 

2、调度销售出库 

调度中心负责在订单支付之后，对接WMS系统，让WMS系统创建销售出库单，包括其他的出入库单 

电商后台将一个订单，购买哪些商品，收货地址，告诉调度中心；然后调度中心负责根据仓库的信息，选择那些商品分别在哪个仓库里进行调度，用什么物流发货，多久可以到 

有几个核心的信息：每个商品购买了几件，每个商品自己的毛重是多少，一个商品的总毛重是多少，收货地址是哪里 

2.1 管理仓库基础数据 

维护仓库信息以及物流公司信息 

仓库信息：仓库名称、地址、联系信息、仓库类型（自营中心仓、自营区域仓）、配送区域 

广州仓库的一级配送区域是广州，二级配送区域是广西、福建、湖南，三级配送区域是其他地方 

每个仓库关联了一些物流公司 

2.2 选择发货仓 

根据调度规则，按照一定的调度逻辑，来进行商品发货的调度，找到对应的发货仓 

设计一个较为简化的发货调度的方法 

（1）不同的仓库，对不同的区域，是有发货的分级的，越近的地方，分级是越近的。有些太偏远的地方，是不支持发货的。同一个省份，可能多个仓库都可以发货，但是一定是有一个仓库是优先级最高的，比如说湖南发货，杭州仓库对湖南就是二级区域；但是广州仓库，可能对湖南就是一级区域 

（2）根据收货地址所在省份，优先找一下，自己是一级区域的仓库，是否有库存，优先从这个仓库发货；如果一级区域不行，可以找自己是二级区域的仓库，也可以发货；如果二级区域不行，直接不支持对这个地区发货这个商品了 

（3）调度这个仓库中用来发货的货位，首先按照商品上架的时间顺序排序，按照先进先出的原则，有这个商品的货位，按照时间先进先出排序，最早上架的商品排在最前面，先发货 

（4）比如找到一个货位，上面有5件商品，如果你要购买一件这个商品，那么就从这个货位去发货就可以了；如果你要购买10件这个商品，会将你的商品，拆分成两个发货条目，先从一个货位取5个商品，再从下一个货位取5个商品 

（5）最终将订单中的每个商品，都直接绑定到一个仓库的一个货位上去 

2.3 创建销售出库单 

销售出库单，包含了订单中的几乎所有的数据，然后还包含了自己对仓库和货位的一个调度，一个商品购买10件，可能会被拆分为两个发货条目，但是每个发货条目，都会将商品关联到一个货位上去 

然后同步到WMS系统 

2.4 创建发货单 

2.5 创建物流单 

跟第三方物流商进行通信，获取一个物流单号 

3、调度退货入库

（1）调度退货入库 

其实调度采购入库，对售后工单中包含的这些退货商品，进行一个调度，将这些商品调度放入一个仓库里，需要根据仓库中的每个货位的剩余容量，然后根据商品的退货件数，将每个商品的退货关联分配到对应的货位上去 

（2）创建退货入库单 

（3）将退货入库单同步到WMS系统

#### 订单中心_需求分析

1、业务知识 

（1）订单有哪些东西 

订单信息：记录订单信息

订单流程：包含订单生成到完成的全流程

订单状态：订单各个状态的流转

订单推送：订单状态变化时，需要推送订单告知关联方

订单管理：订单查询、与WMS交互 

（2）订单的状态 

几种状态：待付款、待发货、待收货、交易成功、已取消、售后中、交易关闭 

2、订单流程 

2.1 订单确认页（通过购物车进入） 

（1）选择一个收获地址

（2）选择一种支付方式：微信，支付宝

（3）送货清单：商品列表（商品名称、缩略图、使用的促销活动、商品总价、毛重、购买数量、库存数量、配送区域是否有货）

（4）下面有一个总计，几件商品、总金额、运费、应付总额、收货地址/收货人/手机号码

（5）点击提交订单 

2.2 订单生成 

此时，你要购买的那些商品的数据，他们对应的那个订单就已经生成了，此时会有一个订单号出来，告诉你这个订单要支付多少钱，24小时内完成支付，否则系统自动取消订单 

下面给出来你选择的支付方式的支付页面，支付宝/微信，扫码支付 

2.3 订单列表 

下单时间、订单号 

订单中包含的商品列表：缩略图、商品名称、购买数量、收货人姓名、总金额、应付金额、订单状态（未付款的时候，叫做等待付款）、跟踪物流、查看订单详情、操作栏（取消订单、付款） 

2.4 订单详情 

订单号、订单状态（等待付款）

订单的操作日志记录，你对订单做的所有的操作，都会记录订单操作日志流水

收货人信息、配送信息、付款信息、发票信息

商品列表：缩略图、商品名称、销售属性、商品编号、商品售价、购买数量

订单总金额、运费、应付总金额 

2.5 取消订单 

（1）手动取消订单：点击按钮后，选择一个取消原因，订单状态变为已取消

（2）自动取消订单：系统自动追踪每个订单，如果是超过24小时没支付的订单，系统直接自动取消，状态为已取消 

2.6 对订单进行支付 

走支付中心，订单状态变为待发货，如果订单支付之后，会给订单关联支付信息 

将订单信息推送到调度中心去 

前面是通过直接在京东上选购商品来看的，后面的流程，就属于系统后台的工作了，我们在京东前台都是看不到的了，画图了 

2.7 对物流进度进行查看 

2.8 确认收货 

（1）手动确认收货

（2）自动确认收货：第三方物流商的状态是已经签收了，然后超过7天没点击确认收货，系统自动确认收货 

2.9 订单包含的信息 

用户信息：用户账号、用户等级

订单基础信息：订单编号、订单状态

收货信息：收货地址、收货人姓名、联系电话、邮编

商品信息：SKU、规格、商品数量、价格、商品图片、商家

优惠信息：优惠券、促销活动、虚拟币抵扣金额

支付信息：支付方式、支付单号、商品总金额、实付金额、运费、优惠券优惠金额、总优惠金额

物流信息：物流公司、物流单号、物流状态

其他信息：发票信息 

2.10 订单的价格计算 

订单实付金额=商品金额（SKU金额合计）+运费-总优惠金额

总优惠金额=促销活动优惠金额+优惠券优惠金额 

2.11 发起退货 

要求你输入退货的原因，以及退货的物流单号，此时状态变为售后中 

以后会补充的一些业务功能 

3、订单管理 

订单查询：订单搜索，条件筛选（订单时间，订单状态，订单来源，订单字段范围） 

订单新建：主要是针对的线下大宗订单，不是用户自己下的，可能是电商网站的大宗商品交易部门的员工为大客户下的 

包括了选择用户、设置收货地址、选择商品（分类、品牌、SKU、名称）、价格和数量设置、支付（客服支付，在这之前用户可能已经将货款打了过来了） 

包括了补发订单（输入原订单号，选择商品），换货订单（输入原订单号，更换商品） 

4、订单售后 

用户退货：用户点击退货申请，客服进行退货审批，系统生成退货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服提交退款申请给财务，财务确认退款 

用户换货：用户点击换货申请，客服进行换货审批，系统生成换货入库单并且同步到WMS系统，用户寄件并且输入快递单号，WMS收货入库，客服手工生成换货订单 

订单审核：用户黑名单过滤（系统），异常订单预警（系统），订单财务风险审核（财务，针对线下大宗订单） 

订单转发货单：主要是针对之前说的线下大宗订单，手工创建订单之后，需要通过这个功能，将订单转为发货单，包括发货单创建/编辑（收货人信息、商品信息、发票信息），发货单同步到WMS系统，WMS同步发货单状态到系统（打印->拣货->配货->包装->称重->出库->在途->签收->缺货） 

订单取消：如果发货单未拣货，可以提交取消申请，进行发货单拦截（同步通知WMS系统），进行取消审批，退款 

订单时常监控：订单状态节点异常时长监控设置，异常订单预警

#### 客服中心_需求分析

这块主要是在用户进行售后的时候，比如说退货，或者是退款，要走售后工单模块1627098499 

1、售后工单列表 

包含的数据有哪些？跟订单的数据是差不多的 

具体包含了一个订单中要退货的一些商品的列表 

2、对售后工单进行审核 

3、确认收到退货商品 

（1）走线下物流，商品退货仓库

（2）将售后工单同步到调度中心里面去

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\0901.png) 

###  10_评论中心的需求分析（发表评论、后台审核）

核心主流程基本都走完了 

（1）采购商品

（2）前台页面

（3）购买商品

（4）商品退货 

这块，主要是用户在前台发表评论，然后可以查看每个商品的评论 

后台可以对所有的评论进行人工审核以及查看，可以删除评论 

1、发表评论 

（1）打分：几颗五角星，一般会对多个维度去打分，商品，客服，物流，我们合并为一个打分

（2）输入评论内容

（3）晒图：支持上传图片

（4）打标签：用已有的评论标签，也可以自己新建一个标签 

2、后台评论管理 

（1）查看评论列表 

专门有运营人员，会负责对不断发表的那些新的评论，进行审核，看一下文字、图片有没有违法，有没有涉黄的 

评论列表包含哪些字段：用户名、评论时间、分数、评论内容前多少个文字的截取、打的标签、状态、好评/中评/差评（4星以上是好评，3星是中评，3星以下是差评）、是否晒图、是否追评、是否默认评价 

评论状态：待审核、审核不通过、已审核、已删除 

（2）查看评论详情 

里面可以看到评论完整的东西，然后可以对评论进行审核，审核通过/审核不通过 

（3）审核评论 

3、前台查看评论列表 

（1）好评率

（2）热门标签的评价数量

（3）评论总数、晒图评论数、追评评论数、好评评论数、中评评论数、差评评论数

（4）评论列表：用户名（保留收尾两个字符，中间的是星号），分数，评论内容，晒图，购买的sku的销售属性值，评论时间

（5）评论支持分页，按照标签来筛选，按照晒图/追评/好评/中评/差评来筛选 

4、默认评价 

系统自动检查，如果一个商品购买超过30天后没有评价，系统就自动给一个默认的评价，好评

### 11_会员中心的需求分析（会员等级、会员积分）

1、会员信息 

会员基础信息：注册时间、手机号、性别、生日、邮箱、收货地址（多个，字段：省/市/区、收货人、详细地址、手机号码）

会员等级：会员成长明细，记录会员成长值增减的原因和时间

会员积分：会员积分变动明细，积分的来源和消耗 

1.1 个人设置功能 

性别、生日、邮箱、收货地址（多个，字段：省/市/区、收货人、详细地址、手机号码） 

2、会员等级 

2.1 两种会员成长模型 

（1）RFM模型 

客户消费行为特征分析模型 

Recency（最近一次消费时间），Frequency（最近一段时间内的消费次数），Monetary（某一个时间范围内的平均客单价或者是累计交易额） 

| R（消费间隔） | 对应成长值 | F（消费频次） | 对应成长值 | M（消费金额） | 对应成长值 |
| ------------- | ---------- | ------------- | ---------- | ------------- | ---------- |
| 7天以内       | 50         | 10次以上      | 50         | 1000元以上    | 50         |
| 30天以内      | 30         | 5次以上       | 20         | 500元以上     | 30         |
| 180天以内     | 10         | 2次以上       | 10         | 100元以上     | 20         |
| 360天以内     | -5         | 1次           | 5          | 100元以上     | 10         |
| 360天以上     | -10        | 0次           | -10        | 0             | -20        |

每隔一个固定周期，比如一周吧，每隔一周，对每个用户的RFM都计算一下 

比如一个用户如果最近两次消费间隔在7天以内，成长值就可以累加50，而且7天以内消费了10次以上，成长值再累加50，7天以内的消费金额加起来超过1000元，成长值再次累加50 

如果出现负数，那么就降低会员等级了 

但是这套模型太过于复杂了，一般还是不采取了 

（2）用户行为增长模型 

这个模型是比较常见的，比如京东的成长模型： 

每天的第一次登录：获得成长值奖励，+5分

购物：订单金额 * 成长系数，算出来一个成长值奖励，10%，100元的商品 * 10% = +10分

评价：对20元以上金额的商品，发表一个评论，可以积累成长值，+10分

晒单：对20元以上金额的商品，进行晒单，可以积累成长值，+10分

退货：扣减成长值，商品金额 * 10%，扣减你的成长值

评论被投诉后删除了：扣减成长值，扣减你的评论的成长值 

2.2 会员等级增长的策略 

累加会员的成长值，会员等级体系 

100分以下：铜牌会员

100分~500分：银牌会员

500分~1000分：金牌会员

1000分以上：钻石会员 

会员一般，在我们这里，主要是跟促销活动相关，创建一个促销活动的时候，有些促销活动，是仅仅针对一些高级别的会员执行的 

3、会员积分 

跟会员成长模型类似，也是在登录、购物、评价、晒单的时候，可以获得相应积分奖励 

但是积分跟会员成长值是两回事，会员成长值不断增加会增加会员等级，越高的会员等级是有特权的。而积累更多的积分，是用来消费和兑换的。 

会员积分，一般是用来兑换礼品的，消耗掉 

都通过同样的成长策略去积累，但是用处不同，会员成长值是不断积累的，不断变多；会员积分是可以消耗掉的，常见的比如说，几百个积分可以兑换一个几十块钱的小东西，充电宝；100积分可以作为1块钱去

### 12_促销中心的需求分析（促销活动、优惠券、价格计算）

#### 促销中心_需求分析

1、业务知识 

促销的类型大致有7种 

满减促销：满100减10、满300减50、满500减80

单品促销：促销期间商品售价直接打折，比如6折

套装促销：A商品50元，B商品80元，一起购买只要120元，便宜10元

赠品促销：购买某个商品可以赠送别的商品

满赠促销：满300元送自拍杆，满500送充电宝，满1000送高端耳机

多买优惠促销：买2件9折，买3件8折，买4件7折 

定金促销：双十一常见，付10元定金，可以抵扣30元现金（以后其实我们会讲到电商的双11大促的系统架构，秒杀架构，电商峰值系统架构，电商API网关架构） 

2、促销活动 

2.1 促销活动管理 

那些促销活动实际上大同小异，主要是分为促销规则、主商品信息、赠品信息 

（1）促销规则 

促销活动条件：促销活动名称、促销时间、会员级别（全员/某等级会员）、活动备注、活动规则 

活动规则，选择上面7种里面的某一种，先通过下拉框进行选择，然后根据选择的活动规则，输入具体的活动规则明细

满减促销，那么就要输入一系列的细则，满多少减多少

单品促销，输入一个折扣

套装促销

赠品促销

满赠促销

多买优惠，输入一系列的细则，就是买几件打几折 

（2）主商品信息 

根据sku编码、商品名称、商品状态、价格范围、商品分类、上架时间，等几个条件，来进行商品的筛选 

筛选出来的商品列表的字段包括：SKU编码、商品名称、价格、优惠内容 

满减促销：不要选择商品了，默认就只能范围是全部商品，就是说无论买什么商品，满多少钱就可以立减多少钱 

单品促销：就是要选择一个或者多个商品，直接会关联上面的那个折扣的 

套装促销：要求选择超过1个商品，多个商品，在这里输入一个多个商品的套装价格 

赠品促销：只能选择一个商品，爱买这些商品的时候，每个商品都会给一份赠品，赠品在下面设置 

满赠促销：默认就是不要选择商品，强制是全部范围的商品 

多买优惠：只能选择一个商品 

我说一点，大家看到这里，不知道能不能理解我为什么不愿意去画原型图，原型图太复杂了，不能的情况下，前端界面是各种变化的 

（3）赠品信息 

选择赠品其实也是选择商品，跟上面是一样的 

赠品促销，可以挂一个或者多个赠品

满赠促销，也可以挂一个或者多个赠品 

2.2 促销活动管理 

创建完一个促销活动之后，需要进行审核操作，可以编辑和删除 

对每个促销活动都可以进行审核，刚开始状态是编辑中，后面可以提交审核，待审核，已审核 

2.3 前台页面展示 

在商品详情页，需要展示出来促销活动

在购物车页面，也需要同时展示商品的促销活动，要求你手动去选择一个促销活动 

一个商品可以同时有多个促销活动 

2.4 订单价格的计算 

走商品中心的价格计算服务  

3、优惠券 

很多种优惠券：现金券（无限制直接用）、满减券、折扣券（购买指定商品时打折） 

（1）优惠券管理 

优惠券信息：优惠券名称、类型、使用条件规则、有效时间、发行量、商品范围 

推广信息：发放方式（可发放可领取、仅可发放、仅可领取），推广范围（免费领取、积分兑换），限领数量，会员等级 

（2）发送/领取优惠券 

用户可以主动领取，就是在一个领券页面里，可以点击按钮来领取 

也可以平台直接发放，那就是平台直接发放给所有用户了 

（3）优惠券核销 

在创建订单的时候，会根据是否使用优惠券，算出来一个优惠后的金额 

（4）看到每个优惠券的使用时间 

4、拼团

多人拼成一个团，享受一个更低的折扣价格 

在对商品进行支付的时候，会判断这个团是否满团，如果满团，那么就停止支付；否则就支付加入这个团 

接下来在规定时间内，达到指定人数就拼团成功，此时将订单变为待发货，后面走发货流程；否则就拼团失败，则需要取消订单，退换款项 

而且参团的人支付之后，就要立即锁定和扣减库存

#### 商品中心_需求分析

1、业务知识 

这边正好给大家讲解一下，我们之前会看到各种各样的打着所谓的电商旗号的一些demo级的项目，商品数据，但是多非常非常的简单 

专业的电商系统里，商品、订单、支付、库存，这几块都是很复杂的 

SKU：Stock Keeping Unit，最小库存单位，最小的商品单位，比如iPhone 7 Plus 128G 银色，就是一个SKU 

Apple iPhone X (A1865) 64GB 深空灰色 => SKU，SKU一定是可以唯一定位到一个实际的商品上的 

Apple iPhone X，它是一个SKU吗？没法唯一定位到一个具体的商品上，它的不同配置的手机，有不同的颜色，有不同的内存，你只有选择了一个颜色+内存，才可以唯一定位一个iphone x的手机 

SPU：Standard Product Unit，产品单元组合，比如iPhone 7 Plus，就是一个SPU，其实类似一个商品的概念吧。但是iPhone 7 Plus是不能具体指代哪个商品的，因为iPhone 7 Plus有很多种，比如不同的内存大小+不同的颜色，就可以组成不同的手机 

我们一般来说，所说的一个商品，我们指的是什么呢？说的是一个SPU，我们都会说，我要买一个iphone x，我们一般不会说要去买一个深灰色32GB的iphone x。 

SKU也可以叫做一个商品，SKU和SPU之间的关系，具体的一个商品，可以定位到一个实体的这么一个商品 

比如iPhone 7 Plus这个SPU为例，有6种颜色（金色、白色、黑色、玫瑰金、银色、亮黑、红色），3种内存大小（32G、128G、256G），所以这个SPU下的SKU有6 * 3 = 18种组合。比如说iPhone 7 Plus 玫瑰金 32G，iPhone 7 Plus 红色 128G，这就是2个SKU 

一个SPU下，有4个SKU，颜色（深空灰色、银色），内存（64G，256G），2 * 2 = 4种组合，4个SKU 

深空灰色+64G，是一个具体的手机

深空灰色+256G，是一个具体的手机

银色+64G，是一个具体的手机

银色+256G，是一个具体的手机 

通常我们说的商品，实际上就是一个SPU 

我这边还得说一下，我这里采取的是类似天猫的那种方式，就是一个商品详情页，显示一个SPU。通过参数的组合选择，可以让用户自己选择和唯一定位一个SKU。 

不同的电商，都不一样，业务层面 

类目：就是SKU所属的分类 

属性：关键属性、销售属性、非关键属性、导购属性，4种。 

关键属性是能唯一确定一个商品的属性，比如说之前提到的手机，那么关键属性可能就有屏幕尺寸、型号，这个是可以唯一确定一个商品的，也就是一个SPU，比如说iPhone 7 Plus，7 Plus就是个型号，这就是一个关键属性，可以确定一个商品了 

iPhone 7 Plus，关键属性，2个，品牌（Apple），型号（iPhone 7 Plus） => 可以定位出来一个SPU 

销售属性，是说确定一个SKU的属性，比如手机的销售属性，就有颜色、内存，比如iPhone 7 Plus 128G 土豪金，就可以确定一个SKU了 => 用来定位SKU 

非关键属性，就是除了关键属性和销售属性之外的其他属性，比如手机就有摄像头像素、接口类型（USB），等等很多 

导购属性，可以用来在商品列表页中作为筛选条件的 

那么我们这里可以想象一下，在京东、淘宝等电商详情页中，看到的是什么？实际上看到的单位就是一个SPU，然后我们需要对这个SPU，对它的销售属性选择对应的值，相当于就是选择了一个具体的要购买的SKU 

而这个SPU，它的关键属性，就确定了它自己本身是一个SPU；销售属性是在商品详情页由用户来选择的；非关键属性实际上是一个SPU的所有SKU都共享的，都是一样的，实际就是所谓的商品规格；导购属性就是这个SPU的可用来进行导购筛选的属性，可以是关键属性、销售属性、非关键属性，都可以 

然后的话呢，是这样的，类目实际上也是一个树形的结构 

父类目（服装） -> 子类目（女装） -> 叶子类目（连衣裙） 

就是这个类目，一般就是3~4层，就可以了，不要层级太多，甚至在前台显示的时候，可以省去第一季的类目，就显示第二级和第三级的类目 

然后每个叶子类目，会关联一堆属性（4种属性） 

在添加商品的时候，给这个商品选择一种叶子类目，然后就会让你输入对应的属性值 

就举个例子吧，比如说，电子产品 -> 手机 -> 智能手机 

比如说，智能手机这个叶子类目，就关联了一堆的属性 

（1）关键属性：品牌，型号

（2）销售属性：颜色（红色，白色，蓝色，土豪金），存储容量（4G，8G，16G，32G，64G）

（3）非关键属性：拍照功能（摄像头像素、摄像头类型、视频显示格式），显示（屏幕尺寸、触摸屏类型、分辨率），网络（网络类型、网络模式）

（4）导购属性：存储容量、网络类型、摄像头像素 

我们在创建一个商品的时候 

选择一个类目：电子产品 -> 手机 -> 智能手机 

输入一个品牌：Apple 

输入关键属性：品牌（Apple），型号（iPhone 7 Plus） 

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G） 

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版） 

导购属性：不需要输入的 

商品名称：苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机 

你会发现什么，商品的核心数据，基本都出来了 

1、属性管理 

属性的增删改查 

这块就是对属性进行管理，先要有属性信息，包括了名称和描述，以及输入方式（多选，输入），如果是单选/多选，需要给出对应的几个选项 

名称、描述、输入方式（多选、输入）、可选值范围 

名称：机身颜色

描述：手机机身的颜色

输入方式：多选

可选值范围：白色、蓝色、红色、土豪金、灰色 

2、类目管理 

类目的基本字段：ID、名称、描述、父类目ID、是否叶子类目 

进入界面，显示一颗类目树（可以点击异步加载子树），类目树子节点新增/编辑 

类目属性管理（新增/编辑属性分组，属性分组添加/删除属性） 

一个类目可以直接关联一些属性，也可以直接关联一个属性组，每个属性组里关联多个属性 

这个基础类目很重要，比如说手机就是一个基础类目，同时这个基础类目有多个属性（前摄像头像素、后摄像头像素、屏幕尺寸、网络制式），选择一个手机类目，同时输入多个类目属性的值，就可以唯一确定一个商品；再比如说一个裤子类目，类目属性就是腰围，裤长，面料材质，厚度 

类目是一个大的类别，但是光有类目不行啊，决定这个类目下一个唯一商品，需要使用类目对应的多个关键属性的值，来确定一个商品 

维护属性的时候，需要对这个属性选择对应的所属类型，可以支持多选，一个属性可以是多种类型，比如可以是销售属性，同时也可以是导购属性 

属性有不同的类别，有关键属性、非关键属性，销售属性，导购属性。关键属性，比如手机的品牌和型号，衣服的品牌和货号，都可以唯一确定一种商品，定位一个SPU；基本属性就是显示在商品规格中的普通属性；销售属性是指的比如衣服的多种颜色，多种尺码，算是一个商品的不同型号，可以唯一定位一个SKU，一般显示在商品信息那块；导购属性，是可以用在商品列表页，进行筛选的属性，可以看一下商品列表页 

这里说一点，分类的属性，是只能选择已经有的属性的，选择的同时，可以勾选是否必填，属性分组。属性分组的概念，就是将多个属性分为一组，比如商品规格里面，就分为了多个组，随便找个商品看看，然后在分组里可以增删改查属性 

这里还有一个属性继承的概念，比如对类目A有1个属性；类目B是类目A的子类目，有1个属性；类目C是类目B的子类目，也有1个属性；那么如果最后在类目C下创建SKU，则会包含1+1+1=3个属性，这是一个属性继承的概念 

类目树可以管理，每个类目管理的属性，可以通过较为复杂的前端操作去关联 

每个类目可以直接关联属性，也可以关联属性组（每个属性组里关联多个属性），关联每个属性的时候，需要给属性选择类型（支持多选） 

类目之间的属性继承关系 

父类目，比如电子产品，有一个属性（操作系统）；手机，有一个属性（机身颜色）；智能手机（触摸屏类型） 

实际上，在智能手机下面添加商品的时候，是会让你输入三个属性的（操作系统+机身颜色+触摸屏类型） 

3、品牌管理 

品牌的增删改查 

这里的信息包括了：中文名、英文名、别名、logo、品牌介绍、品牌授权凭证、是否启用、产地、备注 

做一点特殊说明 

两种类目：前台类目，后台类目 

后台类目：可能是3级的，服装 -> 女装 -> 连衣裙 

前天类目：不想给那么多的层级，希望让用户更好的去选择，女装 -> 连衣裙 

如果商品按照多层级的后台类目在前台进行展示，那么可能很用户搜索的时候就太麻烦了，可能比如在后台类目有3个层级，在前台类目就只要2个层级，此时就需要单独维护一套前台类目，然后跟后台类目进行关联映射 

前台分类管理：分类节点新增/编辑，分类节点排序，分类商品聚合（按基础类目、按品牌、按属性） 

前台类目，一样就是一棵树，不用维护属性；主要是将前台类目，每个层级的类目，都要关联到一个后台的类目上去 

前台类目，我这里就不做了 

4、商品管理模块 

4.1 新建/编辑商品 

维护好了基础数据，包括属性，基础类目，品牌，就可以编辑商品了 

商品从创建到上架可以售卖，是有一个流程的 

商品新增编辑 

商品信息 

类目：在一颗类目树种，去选择一个对应的叶子类目，手机 

品牌：在一个列表框中，可以去选择一个品牌，Apple 

商品编号：每个商品都有一个编号 

商品名称：输入，苹果X【6期免息/当天发】送壳膜Apple/苹果 iPhone X 全网通手机 

商品副名称：输入，当天发 送壳膜 咨询客服不分期价格直降 

毛重：输入，100g 

商品状态：核待审、待上架、审核未通过、已上架、已删除 

外包装长：50cm

外包装宽：100cm

外包装高：200cm 

服务保障：这里其实是可以去选择的。但是我们简化一下，就直接输入。碎屏无忧，全国联保，正品保证，极速退款，赠运费险，7天无理由退换，可开发票 

商品图片：上传商品的一些图片 

商品描述：一般是富文本编辑框，图文混排，插入图片，插入文字 

包装清单： 

采用 Lightning 接头的 EarPods  1 件

iPhone  1 件

Lightning 至 USB 连接线  1 件

5W USB 电源适配器  1 件

Lightning 至 3.5 毫米耳机插孔转换器  1 件 

类目属性值（输入选择的类目的各个属性的值，注意，这里实际就是输入关键属性值和非关键属性值，是一个SPU共享的，但是SKU的销售属性是对每个属性都选择多个值，比如有哪集中颜色，哪几种内存大小） 

输入关键属性：品牌（Apple），型号（iPhone 7 Plus） 

输入销售属性：销售属性不输入，因为在商品详情页上展示的时候，是展示SPU，但是这里要选择每个销售属性可选的值。颜色（白色、土豪金），存储容量（16G，32G，64G） 

非关键属性：输入所有属性的值，拍照功能（摄像头像素 -> 双1200万，摄像头类型 -> 三摄像头，视频显示格式 -> 4k），显示（屏幕尺寸 -> 5.8英寸，触摸屏类型 -> 电容屏，分辨率 -> 2436 * 1124像素），网络（网络类型 -> 无需合约版，网络模式 -> 无需合约版） 

运费（选择物流运费模板，比如是包邮/按重量/按件，后面下订单计算运费的时候都是根据运费模板来计算的） 

库存（所属仓库（石家庄仓库）、库存数量（0件）、库存状态（是否有库存，无库存）、最低预警库存（1000件）） 

商品价格（采购价（8000元）、参考价（8500元）、售价（关联会员体系，不用的会员级别不同的价格，1级会员是8500元，2级会员是8450元，3级会员是8400元，4级会员是8350元，5级会员是8300元）、特殊促销价格（8100元）） 

特别说明：在选择好销售属性的值之后，会自动出来各个销售属性排列组合出来的SKU，对每个SKU，可以具体设置对应的价格和库存；但是也可以对这个SPU设置统一的库存和价格 

4.2 商品的审核 

需要由商品部门的管理人员对这个商品的内容进行审核，内容以及售价 

4.3 审核通过之后，商品的上架和下架 

4.4 商品列表的查询

列表字段：类目、品牌、商品编号、商品名称、商品状态、所属仓库、库存数量、库存状态、采购价、参考价 

筛选条件：类目、品牌、商品编号、商品名称、库存数量范围、参考价范围 

操作栏：编辑、审核、上架/下架、删除 

16个中心，24个服务，一开始，加入更多的中心和服务 

高并发、大数据量、高可用、高性能、高稳定性、中间件、亿级流量，业务和场景都够了 

我大概考虑了一下，几乎后面要涉及到的所有的技术，都可以非常好的使用这种模拟真实的业务场景去带着大家实践 

举个例子，比如redis，你说你去单纯的学习redis有什么用呢？ 

最重要的还是要结合实际的业务场景，你的redis，在复杂的业务场景怎么去用 

mq，在这种系统里面，怎么去用 

5、价格计算
这块，主要是在商品进入订单详情页的时候，根据当前使用的优惠券，或者是促销活动，进行订单最终价格的一个计算 

在订单详情页，需要走一个价格计算的服务，动态的根据当前的促销信息，计算出每个商品实际要支付的价格 

先判断订单里每个商品是否参加了促销，然后看下本地订单中是否满足了促销条件，最后根据促销规则计算出商品的最终价格 

1、订单中心会将整个订单，发到商品中心的价格服务里，让它去完成订单以及其中各个商品的价格的计算 

（1）价格服务，会从促销中心中，将所有的促销活动的数据查询过来，然后进行统一的计算 

（2）促销活动的价格计算 

满减促销：满100减10、满300减50、满500减80

满赠促销：满300元送自拍杆，满500送充电宝，满1000送高端耳机 

单品促销：促销期间商品售价直接打折，比如6折

套装促销：A商品50元，B商品80元，一起购买只要120元，便宜10元

多买优惠促销：买2件9折，买3件8折，买4件7折

赠品促销：购买某个商品可以赠送别的商品 

一共买了3个商品：A商品是100元，B商品是300元，C商品是250元，650元 

如果某个商品选择了单品促销 

直接对这个商品的价格进行折扣，打指定的一个折扣，比如说某个商品，B商品，8折，240元 

A商品是100元，B商品是240元，C商品是250元，590元 

如果某个商品选择了套装促销 

此时需要对订单中结成套装的商品，看一下，如果组成了一个套装的话，此时可以给一个总的优惠价格，A + B = 300元，比如A原来是100，B原来是340，套装是300 => 优惠分摊，40块钱，按照比例分摊优惠，扣减金额。100 - 100 / 440 * 40 = 90.91，A商品；340 - 340 / 400 * 40 = 309.09，B商品 

如果某个商品选择的是多买优惠促销 

会看一下，这个商品一共购买了多少件，如果达到了指定的件数，说可以打折，看一下具体按照规则，可以打几折 

这个时候，每个商品的价格都降低了，有上面3种促销活动的商品价格，都降低了 

假设这个时候，A商品是90.91，B商品是309.09，C商品是180，加起来的总和 = 580元 

满500减80，580 - 80 = 500元，省了80元钱，按照比例分摊 

到此为止。。。。价格就算完了，总的优惠价，每个商品的优惠分摊价格，都出来了 

（3）赠品的处理 

然后就是处理促销 

看一下，如果有某个商品选择的是买赠，此时会在订单中加入一个商品，只不过金额是0元，很多电商，多出来一个商品，只不过金额是0元 

看一下此时订单的总金额，如果达到一定的金额，可以赠送商品，在订单里再加入对应的赠品 

（4）处理优惠券 

如果这个用户有一个有效的优惠券，在购物车下面可以显示一个优惠券下拉框，你可以选择这个订单要使用一个优惠券 

进来会直接去计算，在计算完促销活动的基础之上，会自动给你去应用那个券，折上折 

还有一个，在购物车每个商品的下拉框中，单品折扣优惠券，跟其他的那些促销活动互斥，只能选择一种

### 13_完整的电商系统v1.0产品需求文档整理

### 14_电商系统未来的技术挑战以及业务发展展望 

在目前现有的产品结构下，未来可能会有什么样的技术挑战

随着用户量增长、商品数量增长、业务功能在增加 

1、高并发 -> 高峰并发量上万，最大的价值和优势在哪里，我们可以基于真实的完整的电商流程和系统架构去做高并发的架构改造，我们是基于各种各样的能支撑高并发的技术在我们真实的大型复杂的架构中，去结合业务，进行架构的改造，有一定业务复杂度的系统，如何去支撑高并发的访问 

2、海量数据 -> 也是要依靠大量的技术，去支持海量数据的存储和查询，我们到后面是针对这种真实的挑战，去看说各种技术如何结合业务，去改造系统架构，去支撑海量数据的场景 

3、高可用 -> 各个中心如何保持高可用性，99.99%不能宕机，不能影响购物 

4、安全性/稳定性/伸缩性/扩展性 

5、如何快速支撑业务需求的迭代，支撑越来越大的团队快速迭代开发

业务发展 

1、商品中心 -> 大宗商品购买

2、采购中心 -> 支持采购退货

3、WMS -> 库存调拨、库存盘点

4、支付中心 -> 支付网关、资金清算

5、订单中心 -> 订单监控、订单换货

6、物流中心 -> 跟第三方物流公司的对账和结算

7、评论中心 -> 投诉、点赞、回复

8、会员中心 -> 会员充值，礼品卡

9、促销中心 -> 拼团、双11预收、秒杀

10、客服中心 -> 支持售前

11、财务中心 -> 财务进行对账，清算

12、调度中心 -> 盘盈入库、盘亏出库

13、库存中心 -> 库存预警、自动采购补货

### 15_一张思维导图带你梳理电商系统业务需求

![](C:\Users\zy199005\Desktop\中华石杉\images\java\03\1501.png)

 

 

 

 

 

 

 

  

 

 

 

 

 

 

  

 

  

  

  

 

 

 

 